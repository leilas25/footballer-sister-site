<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fixtures & Live Scores – The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .logo { width: 44px; height: 44px; border-radius: 9999px; object-fit: cover; background:#f1f5f9; }
    .chip { font-size:.75rem; padding:.15rem .5rem; border-radius:9999px }
    .chip-blue { background:#e0f2fe; color:#075985 }
    .chip-green{ background:#dcfce7; color:#166534 }
    .chip-gray { background:#e5e7eb; color:#374151 }

    /* tabs */
    .tab { padding:.9rem 1.4rem; border-radius:999px; font-weight:800; font-size:1.3rem }
    .tab-inactive { background:white; border:1px solid #fce8ef; color:#be185d; }
    .tab-active { background: linear-gradient(90deg,#be185d,#f472b6); color:white; box-shadow:0 6px 18px rgba(0,0,0,0.06); }

    /* card */
    .fx-card { background:white; border-radius:20px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,0.04); border:1px solid #fde7ef; }
    .score { font-weight:900; font-size:1.15rem; }
    .small-muted { color:#6b7280; }
  </style>
</head>
<body class="bg-pink-50 font-sans text-black min-h-screen">

  <header class="pt-8 px-8">
    <h1 class="text-5xl font-extrabold text-rose-700">Fixtures & Live Scores</h1>
    <p class="text-gray-600 mt-2">U14 & U19 • Jomo Cosmos</p>
  </header>

  <main class="px-8 max-w-4xl mx-auto pt-8 pb-20">

    <!-- Tabs -->
    <div class="flex gap-6 items-center mb-8">
      <button id="tabU14" class="tab tab-active">U14 games</button>
      <button id="tabU19" class="tab tab-inactive">U19 games</button>
      <div class="ml-auto small-muted">Showing <span id="countLabel">—</span></div>
    </div>

    <!-- list -->
    <div id="fxList" class="space-y-4">
      <p class="text-center text-gray-500">Loading fixtures…</p>
    </div>
  </main>

  <footer class="bg-pink-900 text-white text-center py-6">
    <p>&copy; <span id="year"></span> The Footballer’s Sister</p>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // your firebase config — must match admin page
    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const APP_ID = "1:65396604482:web:0f31625a714aa8352337db";
    const FIXTURES_PATH = `/artifacts/${APP_ID}/public/data/fixtures`;

    const JC_U14 = "/images/jc-u14.png";
    const JC_U19 = "/images/jc-u19.png";
    const OPP    = "/images/opponent.png";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const fxList = document.getElementById('fxList');
    const tabU14 = document.getElementById('tabU14');
    const tabU19 = document.getElementById('tabU19');
    const countLabel = document.getElementById('countLabel');

    let fixtures = [];
    let activeTab = 'U14';

    const esc = s => String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    const chip = (s) => s==='live' ? 'chip chip-green' : (s==='finished' ? 'chip chip-gray' : 'chip chip-blue');

    function render() {
      // filter by age group and sort chronologically
      const rows = fixtures
        .filter(f => (f.ageGroup || '').toUpperCase() === activeTab.toUpperCase())
        .sort((a,b) => {
          // use kickoffISO if present, else fallback to kickoffTs seconds
          const ta = a.kickoffISO ? new Date(a.kickoffISO).getTime() : (a.kickoffTs?.seconds ? a.kickoffTs.seconds*1000 : 0);
          const tb = b.kickoffISO ? new Date(b.kickoffISO).getTime() : (b.kickoffTs?.seconds ? b.kickoffTs.seconds*1000 : 0);
          return ta - tb;
        });

      fxList.innerHTML = '';
      countLabel.textContent = rows.length;

      if (!rows.length) {
        fxList.innerHTML = `<p class="text-center text-gray-500">No ${activeTab} fixtures found.</p>`;
        return;
      }

      rows.forEach(f => {
        const when = f.kickoffTs?.toDate ? f.kickoffTs.toDate().toLocaleString() : (f.kickoffISO ? new Date(f.kickoffISO).toLocaleString() : '');
        const badge = f.status ? `<span class="${chip(f.status)} ml-2">${(f.status||'').toUpperCase()}</span>` : '';
        const comp  = f.competition ? esc(f.competition) : '';
        const scorePresent = (typeof f.scoreHome !== 'undefined' && typeof f.scoreAway !== 'undefined');
        const scoreHtml = scorePresent ? `<div class="score">${esc(String(f.scoreHome))} <span class="mx-2">:</span> ${esc(String(f.scoreAway))}</div>` : `<div class="small-muted">vs</div>`;

        const homeLogo = f.teamALogoUrl || (f.ageGroup==='U14' ? JC_U14 : JC_U19);
        const awayLogo = f.teamBLogoUrl || OPP;

        const card = document.createElement('div');
        card.className = 'fx-card';

        card.innerHTML = `
          <div class="text-sm small-muted">${esc(when)} ${f.venue ? ' • ' + esc(f.venue): ''}</div>

          <div class="flex items-center justify-between gap-4 mt-3">
            <div class="flex items-center gap-3">
              <img class="logo" src="${esc(homeLogo)}" alt="home" onerror="this.onerror=null;this.src='${JC_U14}'"/>
              <div>
                <div style="font-weight:800;">${esc(f.teamA || 'Jomo Cosmos')}</div>
                <div class="small-muted text-sm">${esc(f.ageGroup || '')} ${f.homeAway==='home' ? '(Home)' : ''}</div>
              </div>
            </div>

            <div class="text-center">
              ${scoreHtml}
              <div class="mt-1 text-sm text-gray-600">${esc(f.broadcast || '')} ${badge}</div>
            </div>

            <div class="flex items-center gap-3">
              <div class="text-right">
                <div style="font-weight:800;">${esc(f.teamB || 'Opponent')}</div>
                <div class="small-muted text-sm">${esc(f.opponentNote || '')}</div>
              </div>
              <img class="logo" src="${esc(awayLogo)}" alt="away" onerror="this.onerror=null;this.src='${OPP}'"/>
            </div>
          </div>

          <div class="mt-3 flex gap-3 items-center">
            ${f.streamUrl ? `<a class="inline-block px-3 py-2 rounded-full text-sm bg-rose-600 text-white hover:bg-rose-700" target="_blank" rel="noopener" href="${esc(f.streamUrl)}">Watch link</a>` : ''}
            <div class="small-muted">Posted: ${ f.createdAt && f.createdAt.seconds ? new Date(f.createdAt.seconds*1000).toLocaleString() : '' }</div>
          </div>
        `;

        fxList.appendChild(card);
      });
    }

    // wire tab buttons
    tabU14.addEventListener('click', () => { activeTab='U14'; tabU14.classList.replace('tab-inactive','tab-active'); tabU19.classList.replace('tab-active','tab-inactive'); render(); });
    tabU19.addEventListener('click', () => { activeTab='U19'; tabU19.classList.replace('tab-inactive','tab-active'); tabU14.classList.replace('tab-active','tab-inactive'); render(); });

    // listen to fixtures collection
    onSnapshot(collection(db, FIXTURES_PATH), snap => {
      fixtures = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      render();
    }, err => {
      fxList.innerHTML = `<p class="text-center text-red-600">Unable to load fixtures.</p>`;
      console.error('fixtures onSnapshot error', err);
    });

    // start with U14 active
    tabU14.click();
  </script>
</body>
</html>
