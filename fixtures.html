<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fixtures & Live Scores • The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* shared look */
    body { background:#fff6f8; }
    .site-header { background: linear-gradient(180deg,#ffeef6,#fff0f6); border-bottom:1px solid rgba(234,179,197,0.35); backdrop-filter: blur(6px); }
    .logo-title { color:#be185d; font-weight:800; letter-spacing:0.6px; }
    .nav-pill { padding:.6rem 1.1rem; border-radius:999px; border:1px solid rgba(249,207,217,0.7); background:white;}
    .tab-btn { min-width:180px; padding:.9rem 1.6rem; border-radius:999px; font-weight:800; box-shadow: 0 6px 18px rgba(0,0,0,0.04); border:1px solid rgba(243,211,226,0.7); background:white; }
    .tab-active { background: linear-gradient(90deg,#be185d,#f472b6); color:white; border-color:transparent; }
    .fixture-card { background:white; border-radius:12px; padding:14px; box-shadow:0 6px 18px rgba(0,0,0,0.04); border:1px solid #f3d3e2; }
    .team-logo { width:64px; height:64px; object-fit:cover; border-radius:8px; border:1px solid #f3d3e2; }
    footer .footer-badge { display:inline-block; background: linear-gradient(90deg,#be185d,#f472b6); color:white; padding:.45rem .85rem; border-radius:999px; font-weight:700; }
    /* dropdown open animation helper */
    .dropdown-open { transform: translateY(0); opacity: 1; transition: transform .16s ease-out, opacity .16s ease-out; }
  </style>
</head>
<body class="font-sans text-black">

  <!-- HEADER with dropdown nav (centered items on large screens) -->
  <header class="site-header sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-6 py-5 flex items-center gap-4">
      <a class="flex items-center gap-3" href="index.html" aria-label="Home">
        <svg width="42" height="42" viewBox="0 0 24 24" fill="none" class="rounded-full" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#fff0f6"/><path d="M6 12h12M12 6v12" stroke="#be185d" stroke-width="1.5" stroke-linecap="round"/></svg>
        <div>
          <div class="text-xl logo-title">THE FOOTBALLER’S SISTER</div>
          <div class="text-xs text-rose-500">Behind the Game</div>
        </div>
      </a>

      <!-- centered nav (collapses to dropdown on small screens) -->
      <nav class="ml-auto hidden md:flex items-center gap-3">
        <a class="nav-pill text-rose-600" href="index.html">Home</a>
        <a class="nav-pill text-rose-600" href="behind.html">Behind the Game</a>
        <a class="nav-pill text-rose-600" href="meet.html">Meet Leila</a>
        <a class="nav-pill text-rose-600" href="qa.html">Q&A</a>
        <a class="nav-pill text-rose-600" href="support.html">Support Wall</a>
        <a class="nav-pill text-rose-600" href="giveaways.html">Giveaways</a>
        <a class="nav-pill text-rose-600 font-bold" href="fixtures.html">Fixtures & Live Scores</a>
      </nav>

      <!-- desktop dropdown button (same menu used elsewhere) -->
      <div class="relative hidden md:block ml-4">
        <button id="navButton" class="inline-flex items-center nav-pill text-rose-600" aria-expanded="false">
          <span id="navTitle">Fixtures & Live Scores</span>
          <svg class="ml-2 h-4 w-4 text-rose-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" /></svg>
        </button>

        <div id="dropdownMenu" class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 transform scale-95 opacity-0">
          <div class="py-1">
            <a href="index.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Home</a>
            <a href="behind.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Behind the Game</a>
            <a href="meet.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Meet Leila</a>
            <a href="qa.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Q&A</a>
            <a href="support.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Support Wall</a>
            <a href="fixtures.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50 font-semibold">Fixtures & Live Scores</a>
            <a href="giveaways.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Giveaways</a>
          </div>
        </div>
      </div>

      <!-- mobile dropdown -->
      <div class="md:hidden ml-auto relative">
        <button id="mobileNavBtn" class="nav-pill">Menu ▾</button>
        <div id="mobileNav" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border hidden">
          <a href="index.html" class="block px-4 py-2 hover:bg-pink-50">Home</a>
          <a href="behind.html" class="block px-4 py-2 hover:bg-pink-50">Behind the Game</a>
          <a href="meet.html" class="block px-4 py-2 hover:bg-pink-50">Meet Leila</a>
          <a href="qa.html" class="block px-4 py-2 hover:bg-pink-50">Q&A</a>
          <a href="support.html" class="block px-4 py-2 hover:bg-pink-50">Support Wall</a>
          <a href="fixtures.html" class="block px-4 py-2 hover:bg-pink-50 font-semibold">Fixtures & Live Scores</a>
          <a href="giveaways.html" class="block px-4 py-2 hover:bg-pink-50">Giveaways</a>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 py-12">
    <h1 class="text-6xl font-extrabold text-rose-700 leading-tight mb-4">Fixtures & Live Scores</h1>
    <p class="text-xl text-gray-600 mb-10">Catch upcoming U14 & U19 fixtures below — scores update live from the admin panel.</p>

    <!-- Tabs centered -->
    <div class="w-full mb-8">
      <div class="flex justify-center">
        <div class="flex gap-6">
          <button id="tabU14" class="tab-btn tab-active" type="button">U14</button>
          <button id="tabU19" class="tab-btn" type="button">U19</button>
        </div>
      </div>
    </div>

    <!-- Filters & info -->
    <div id="fixturesContainer" class="grid gap-6">
      <div id="fixturesList" class="grid gap-4">
        <div class="text-gray-500">Loading fixtures…</div>
      </div>
    </div>
  </main>

  <footer class="bg-pink-900 text-white text-center py-6 mt-12">
    <div class="max-w-6xl mx-auto">
      <small><span class="footer-badge">© <span id="year"></span> The Footballer’s Sister</span></small>
    </div>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- Firestore read-only for public fixtures -->
  <script type="module">
    // FIREBASE CONFIG - same as admin
    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const APP_ID = firebaseConfig.appId;
    const FIXTURES_COLLECTION_PATH = `/artifacts/${APP_ID}/public/data/fixtures`;

    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tabU14 = document.getElementById('tabU14');
    const tabU19 = document.getElementById('tabU19');
    const fixturesList = document.getElementById('fixturesList');
    const mobileNavBtn = document.getElementById('mobileNavBtn');
    const mobileNav = document.getElementById('mobileNav');
    const navButton = document.getElementById('navButton');
    const dropdownMenu = document.getElementById('dropdownMenu');

    // mobile nav toggle
    mobileNavBtn?.addEventListener('click', () => {
      mobileNav.classList.toggle('hidden');
    });

    // desktop dropdown toggle
    navButton?.addEventListener('click', (e) => {
      const isHidden = dropdownMenu.classList.contains('hidden');
      if (isHidden) {
        dropdownMenu.classList.remove('hidden');
        // small animation class
        setTimeout(()=> dropdownMenu.classList.add('dropdown-open'), 10);
      } else {
        dropdownMenu.classList.remove('dropdown-open');
        setTimeout(()=> dropdownMenu.classList.add('hidden'), 180);
      }
    });

    // click outside to close desktop dropdown
    document.addEventListener('click', (e) => {
      if (navButton && !navButton.contains(e.target) && dropdownMenu && !dropdownMenu.contains(e.target)) {
        dropdownMenu.classList.remove('dropdown-open');
        setTimeout(()=> dropdownMenu.classList.add('hidden'), 180);
      }
    });

    let currentTab = 'U14'; // default
    function setActiveTab(tab) {
      currentTab = tab;
      if (tab === 'U14') {
        tabU14.classList.add('tab-active');
        tabU19.classList.remove('tab-active');
      } else {
        tabU19.classList.add('tab-active');
        tabU14.classList.remove('tab-active');
      }
      renderFixtures(lastDocs);
    }
    tabU14.addEventListener('click', () => setActiveTab('U14'));
    tabU19.addEventListener('click', () => setActiveTab('U19'));

    // utility
    function escapeHtml(s){ if(s === null || typeof s === 'undefined') return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    let lastDocs = [];

    // listen to fixtures collection (real-time)
    try {
      const ref = collection(db, FIXTURES_COLLECTION_PATH);
      const q = query(ref);
      onSnapshot(q, (snap) => {
        lastDocs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        // sort by kickoffISO if present
        lastDocs.sort((a,b) => {
          const ta = a.kickoffISO ? new Date(a.kickoffISO).getTime() : (a.createdAt?.seconds ? a.createdAt.seconds*1000 : 0);
          const tb = b.kickoffISO ? new Date(b.kickoffISO).getTime() : (b.createdAt?.seconds ? b.createdAt.seconds*1000 : 0);
          return ta - tb;
        });
        renderFixtures(lastDocs);
      }, (err) => {
        console.error('fixtures onSnapshot error', err);
        fixturesList.innerHTML = '<div class="text-red-600">Could not load fixtures.</div>';
      });
    } catch (err) {
      console.error('Failed to attach fixtures listener', err);
      fixturesList.innerHTML = '<div class="text-red-600">Could not load fixtures.</div>';
    }

    function formatKickoff(f) {
      try {
        if (f.kickoffISO) return new Date(f.kickoffISO).toLocaleString();
        if (f.kickoffTs && f.kickoffTs.seconds) return new Date(f.kickoffTs.seconds*1000).toLocaleString();
      } catch(e){}
      return '';
    }

    function renderFixtures(docs) {
      fixturesList.innerHTML = '';
      const filtered = docs.filter(f => {
        const ag = (f.ageGroup || '').toLowerCase();
        if (!ag) return false;
        if (currentTab === 'U14') return ag === 'u14' || ag === 'u/14' || ag.includes('14');
        if (currentTab === 'U19') return ag === 'u19' || ag === 'u/19' || ag.includes('19');
        return true;
      });

      if (!filtered.length) {
        fixturesList.innerHTML = `<div class="text-gray-500">No ${escapeHtml(currentTab)} fixtures yet.</div>`;
        return;
      }

      filtered.forEach(f => {
        const kickoff = formatKickoff(f);
        const scorePresent = (typeof f.scoreHome !== 'undefined' && typeof f.scoreAway !== 'undefined' && f.scoreHome !== null && f.scoreAway !== null);
        const html = `
          <div class="fixture-card grid md:grid-cols-12 gap-4 items-center">
            <div class="md:col-span-2 flex items-center gap-3">
              <img class="team-logo" src="${escapeHtml(f.teamALogoUrl || 'images/opponent.png')}" alt="${escapeHtml(f.teamA||'Team A')}"/>
              <div class="text-sm font-semibold">${escapeHtml(f.teamA || 'Team A')}</div>
            </div>

            <div class="md:col-span-6 text-center">
              <div class="text-sm text-gray-500">${escapeHtml(kickoff)} ${ f.venue ? ' · ' + escapeHtml(f.venue) : '' }</div>
              <div class="text-xl font-bold mt-2">
                ${ scorePresent ? `<span class="text-rose-600">${escapeHtml(String(f.scoreHome))}</span> <span class="text-gray-600">:</span> <span class="text-rose-600">${escapeHtml(String(f.scoreAway))}</span>` : '<span class="text-gray-400">vs</span>' }
              </div>
              <div class="text-sm text-gray-600 mt-1">${escapeHtml(f.broadcast || '')}</div>
            </div>

            <div class="md:col-span-2 flex items-center gap-3 justify-end">
              <div class="text-sm font-semibold">${escapeHtml(f.teamB || 'Team B')}</div>
              <img class="team-logo" src="${escapeHtml(f.teamBLogoUrl || 'images/opponent.png')}" alt="${escapeHtml(f.teamB||'Team B')}"/>
            </div>

            <div class="md:col-span-2 flex items-center justify-end">
              <div class="text-xs text-gray-500">${escapeHtml(f.ageGroup || '')} · ${escapeHtml(f.status || '')}</div>
            </div>
          </div>
        `;
        const wrapper = document.createElement('div');
        wrapper.innerHTML = html;
        fixturesList.appendChild(wrapper.firstElementChild);
      });
    }

    // set default tab active
    setActiveTab('U14');
  </script>
</body>
</html>
