<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fixtures & Live Scores – The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="data:,">
  <style>
    .logo { width: 36px; height: 36px; border-radius: 9999px; object-fit: cover; background:#f3f4f6; }
  </style>
</head>
<body class="bg-pink-50 text-black font-sans min-h-screen flex flex-col">

  <!-- Header -->
  <header class="fixed top-0 w-full flex justify-between items-center px-6 py-4 bg-pink-100 shadow z-50">
    <h1 class="text-xl font-bold uppercase text-rose-600">The Footballer’s Sister</h1>
    <nav class="space-x-6">
      <a href="index.html" class="hover:underline text-rose-600">Home</a>
      <a href="bts.html" class="hover:underline text-rose-600">Behind the Game</a>
      <a href="leila.html" class="hover:underline text-rose-600">Meet Leila</a>
      <a href="questions.html" class="hover:underline text-rose-600">Q&amp;A</a>
      <a href="support-wall.html" class="hover:underline text-rose-600">Support Wall</a>
      <a href="fixtures.html" class="font-semibold underline text-rose-600">Fixtures</a>
    </nav>
  </header>

  <main class="flex-grow pt-32 px-6 pb-20 max-w-5xl mx-auto">
    <h2 class="text-4xl font-bold mb-2 text-rose-700 text-center">Fixtures & Live Scores</h2>
    <p class="text-center text-gray-600 mb-6">U14 & U19 • Jomo Cosmos</p>

    <!-- Filters -->
    <div class="flex flex-wrap gap-2 justify-center mb-6">
      <select id="f-level" class="border rounded px-3 py-2">
        <option value="all">All Levels</option>
        <option value="U14">U14</option>
        <option value="U19">U19</option>
      </select>
      <select id="f-status" class="border rounded px-3 py-2">
        <option value="all">All Status</option>
        <option value="scheduled">Scheduled</option>
        <option value="live">LIVE</option>
        <option value="finished">Finished</option>
      </select>
    </div>

    <!-- List -->
    <div id="fxWrap" class="grid gap-4"></div>

    <!-- Empty -->
    <p id="emptyNote" class="hidden text-center text-gray-500 mt-6">No fixtures to display.</p>
  </main>

  <footer class="bg-pink-900 text-white text-center py-6">
    <p>&copy; <span id="year"></span> The Footballer’s Sister. All rights reserved.</p>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const APP_ID = "1:65396604482:web:0f31625a714aa8352337db";
    const FIXTURES_PATH = `artifacts/${APP_ID}/public/data/fixtures`;

    const JC_LOGO_U14 = "/images/jc-u14.png";
    const JC_LOGO_U19 = "/images/jc-u19.png";

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const fxWrap = document.getElementById('fxWrap');
    const emptyNote = document.getElementById('emptyNote');
    const fLevel = document.getElementById('f-level');
    const fStatus = document.getElementById('f-status');

    const esc = s => String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    const badge = st => st==='live' ? 'bg-green-100 text-green-700' :
                         st==='finished' ? 'bg-gray-100 text-gray-700' : 'bg-blue-100 text-blue-700';

    let fixtures = [];

    const qFixtures = query(collection(db, FIXTURES_PATH), orderBy('kickoffTs','asc'));
    onSnapshot(qFixtures, snap => {
      fixtures = snap.docs.map(d=>({id:d.id, ...d.data()}));
      render();
    });

    function render(){
      const level = fLevel.value;
      const status = fStatus.value;
      const list = fixtures.filter(f => (level==='all' || f.level===level) &&
                                        (status==='all' || f.status===status));
      fxWrap.innerHTML = '';
      if (!list.length) {
        emptyNote.classList.remove('hidden');
        return;
      }
      emptyNote.classList.add('hidden');

      list.forEach(f=>{
        const when = f.kickoffTs?.toDate ? f.kickoffTs.toDate().toLocaleString() : '';
        const sc = (f.status==='live'||f.status==='finished') ? `${f.scoreHome ?? 0} : ${f.scoreAway ?? 0}` : '';
        const homeLogo = f.homeLogoUrl || (f.level === 'U14' ? JC_LOGO_U14 : JC_LOGO_U19);
        const awayLogo = f.awayLogoUrl || '/images/opponent.png';

        const card = document.createElement('div');
        card.className = 'bg-white border rounded-xl p-4 shadow';
        card.innerHTML = `
          <div class="flex flex-col gap-3">
            <div class="text-sm text-gray-500">${when} • ${esc(f.venue||'')}</div>

            <div class="flex items-center justify-between gap-3">
              <!-- Home (JC) -->
              <div class="flex items-center gap-2">
                <img src="${esc(homeLogo)}" alt="Jomo Cosmos" class="logo" onerror="this.style.visibility='hidden'"/>
                <div class="text-sm text-gray-600">Jomo Cosmos ${esc(f.level||'')} ${f.homeAway==='home'?'(Home)':'(Away)'}</div>
              </div>

              <div class="text-xs text-gray-500">vs</div>

              <!-- Away (Opponent) -->
              <div class="flex items-center gap-2">
                <div class="text-right">
                  <div class="text-sm text-gray-600">${esc(f.opponent||'')}</div>
                </div>
                <img src="${esc(awayLogo)}" alt="Opponent" class="logo" onerror="this.style.visibility='hidden'"/>
              </div>
            </div>

            <div class="text-sm text-gray-600">${esc(f.competition||'')}
              ${f.status ? ` <span class="ml-2 text-xs px-2 py-0.5 rounded-full ${badge(f.status)}">${f.status.toUpperCase()}</span>`:''}
              ${sc ? ` <span class="ml-1 font-bold">${sc}</span>` : ''}
            </div>

            ${f.streamUrl ? `<a class="inline-block mt-2 px-3 py-1 rounded-full text-sm bg-rose-600 text-white hover:bg-rose-700" target="_blank" href="${esc(f.streamUrl)}">Watch live</a>`:''}
          </div>
        `;
        fxWrap.appendChild(card);
      });
    }

    fLevel.onchange = render;
    fStatus.onchange = render;
  </script>
</body>
</html>
