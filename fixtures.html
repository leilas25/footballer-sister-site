<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fixtures & Live Scores • The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --accent: #be185d; --muted: #6b7280; }
    body { background:#fff6f8; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color: #111827; margin:0; }

    /* header/footer match Meet Leila */
    header.bts-header {
      background: linear-gradient(180deg, rgba(246,213,239,0.6), rgba(255,241,248,0.6));
      border-bottom: 1px solid rgba(235,200,215,0.6);
      backdrop-filter: blur(4px);
      /* ensure header sits above most page content */
      z-index: 500;
    }
    .site-title { color: var(--accent); font-weight: 800; letter-spacing: .02em; }
    footer .footer-badge {
      display:inline-block;
      background: linear-gradient(90deg,#be185d,#f472b6);
      color:white;
      padding:.45rem .85rem;
      border-radius:999px;
      font-weight:700;
    }

    /* fixtures visuals */
    .page-hero { max-width:1100px; margin:0 auto; padding:3.25rem 1.5rem 2rem; }
    .hero-title { font-size:3rem; font-weight:800; color:#be185d; margin:0 0 .6rem; }
    .hero-sub { color:#4b5563; font-size:1.125rem; margin-bottom:1.5rem; }

    .tabs-wrap { display:flex; justify-content:center; gap:1.25rem; margin-bottom:2rem; }
    .tab-btn { min-width:160px; padding:.9rem 1.6rem; border-radius:999px; font-weight:800; border:1px solid rgba(243,211,226,0.7); background:white; box-shadow: 0 6px 18px rgba(0,0,0,0.04); color:#111827; }
    .tab-active { background: linear-gradient(90deg,#be185d,#f472b6); color:white; border-color:transparent; }

    .fixtures-wrap { max-width:1100px; margin:0 auto; padding:0 1.5rem 3.25rem; }
    .fixture-card { background:white; border-radius:12px; padding:14px; box-shadow:0 6px 18px rgba(0,0,0,0.04); border:1px solid #f3d3e2; display:grid; grid-template-columns: 1fr 2fr 1fr 160px; gap:12px; align-items:center; }
    .team-logo { width:64px; height:64px; object-fit:cover; border-radius:8px; border:1px solid #f3d3e2; }
    .fixture-meta { font-size:.95rem; color:#6b7280; }
    .score { font-size:1.5rem; font-weight:800; color:#be185d; }

    .watch-btn {
      display:inline-flex; align-items:center; gap:8px;
      background: linear-gradient(90deg,#be185d,#f472b6);
      color: white; padding:.5rem .8rem; border-radius:999px; font-weight:800; text-decoration:none;
      box-shadow: 0 6px 14px rgba(190,24,93,0.12);
    }

    @media (max-width:900px){
      .fixture-card { grid-template-columns: 1fr; text-align:center; gap:8px; }
      .fixture-meta { text-align:center; }
      .fixture-card .right-meta { justify-content:center; }
      .page-hero { padding-top:2.5rem; }
      .hero-title { font-size:2.25rem; }
    }

    /* make sure dropdown sits above everything (higher than modals/backdrops) */
    #dropdownMenu {
      z-index: 1000 !important;
      pointer-events: auto; /* ensure clickable */
      overflow: visible;
    }

    /* dropdown animation helper */
    .dropdown-open { transform: translateY(0); opacity:1; transition: transform .16s ease-out, opacity .16s ease-out; }
  </style>
</head>
<body>

  <!-- Header / Dropdown (identical structure to Meet Leila) -->
  <header class="bts-header fixed top-0 left-0 right-0">
    <div class="flex justify-between items-center px-6 py-4 container" style="max-width:1100px; margin:0 auto;">
      <div style="display:flex;align-items:center;gap:1rem;">
        <div class="site-title" style="font-size:1.15rem;">THE FOOTBALLER’S SISTER</div>
      </div>

      <div class="relative inline-block text-left" style="z-index:0;">
        <button id="navButton"
          class="inline-flex justify-center w-full rounded-md border border-pink-200 shadow-sm px-4 py-2 bg-white text-sm font-medium text-rose-600 hover:bg-pink-50 focus:outline-none"
          aria-expanded="false">
          <span id="navTitle">Loading...</span>
          <svg class="-mr-1 ml-2 h-5 w-5 text-rose-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
          </svg>
        </button>

        <!-- NOTE: z-index set in CSS above to ensure dropdown appears above other page elements -->
        <div id="dropdownMenu"
          class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 transform transition-all duration-200 ease-out scale-95 opacity-0"
          style="display:none; will-change:transform,opacity;">
          <div class="py-1">
            <a href="index.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Home</a>
            <a href="bts.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Behind the Game</a>
            <a href="leila.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Meet Leila</a>
            <a href="questions.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Q&A</a>
            <a href="support-wall.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Support Wall</a>
            <a href="fixtures.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Fixtures & Live Scores</a>
            <a href="giveaways.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Giveaways</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- spacer so content doesn't hide under fixed header -->
  <div style="height:92px;"></div>

  <!-- Hero -->
  <section class="page-hero">
    <div style="max-width:1100px;margin:0 auto;padding:0 1.5rem;">
      <h1 class="hero-title">Fixtures & Live Scores</h1>
      <p class="hero-sub">Catch upcoming U14 & U19 fixtures below — scores update live from the admin panel.</p>

      <!-- centered tabs -->
      <div class="tabs-wrap" role="tablist" aria-label="Age group tabs">
        <button id="tabU14" class="tab-btn tab-active" role="tab" aria-selected="true">U14</button>
        <button id="tabU19" class="tab-btn" role="tab" aria-selected="false">U19</button>
      </div>
    </div>
  </section>

  <!-- Fixtures list -->
  <section class="fixtures-wrap">
    <div id="fixturesList" style="display:grid; gap:12px;">
      <div class="text-gray-500">Loading fixtures…</div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="text-center py-6" style="background:transparent;">
    <div class="container" style="max-width:1100px; margin:0 auto;">
      <small class="footer-badge">© <span id="year"></span> The Footballer’s Sister</small>
    </div>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- NAV DROPDOWN SCRIPT - robust open/close & ensures dropdown not clipped -->
  <script>
    (function(){
      const navButton = document.getElementById('navButton');
      const dropdownMenu = document.getElementById('dropdownMenu');
      const navItems = document.querySelectorAll('.nav-item');
      const navTitle = document.getElementById('navTitle');
      const currentPage = window.location.pathname.split('/').pop() || 'index.html';
      const pageTitles = {
        "index.html": "Home",
        "bts.html": "Behind the Game",
        "leila.html": "Meet Leila",
        "questions.html": "Q&A",
        "support-wall.html": "Support Wall",
        "fixtures.html": "Fixtures & Live Scores",
        "giveaways.html": "Giveaways"
      };

      // show readable current page text
      navTitle.textContent = pageTitles[currentPage] || "Menu";

      // highlight current nav item (defensive: compare filenames)
      navItems.forEach(link => {
        try {
          const href = (link.getAttribute('href') || '').split('/').pop();
          if (href === currentPage) link.classList.add("font-semibold", "text-rose-600");
        } catch(e){}
      });

      // open/close helpers (explicit display + animation class)
      function openMenu(){
        dropdownMenu.style.display = 'block';             // remove 'display:none'
        dropdownMenu.classList.remove('hidden');          // remove the tailwind "hidden"
        // small delay to allow style changes to settle, then play the CSS transition
        requestAnimationFrame(()=> dropdownMenu.classList.add('dropdown-open'));
        navButton.setAttribute('aria-expanded','true');
      }
      function closeMenu(){
        dropdownMenu.classList.remove('dropdown-open');
        navButton.setAttribute('aria-expanded','false');
        // after animation, hide completely
        setTimeout(()=> {
          dropdownMenu.style.display = 'none';
          dropdownMenu.classList.add('hidden');
        }, 180);
      }

      navButton.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = dropdownMenu.style.display === 'block' && dropdownMenu.classList.contains('dropdown-open');
        if (isOpen) closeMenu(); else openMenu();
      });

      // clicking anywhere outside closes menu
      document.addEventListener('click', (e) => {
        if (!navButton.contains(e.target) && !dropdownMenu.contains(e.target)) closeMenu();
      });

      // escape to close
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMenu();
      });

      // close menu when a nav link is clicked (mobile friendly)
      navItems.forEach(a => a.addEventListener('click', () => closeMenu()));
    })();
  </script>

  <!-- Firestore fixtures logic + tabs (unchanged, real-time) -->
  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const APP_ID = firebaseConfig.appId;
    const FIXTURES_COLLECTION_PATH = `/artifacts/${APP_ID}/public/data/fixtures`;

    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tabU14 = document.getElementById('tabU14');
    const tabU19 = document.getElementById('tabU19');
    const fixturesList = document.getElementById('fixturesList');

    let currentTab = 'U14';
    function setActiveTab(tab) {
      currentTab = tab;
      if (tab === 'U14') {
        tabU14.classList.add('tab-active'); tabU14.setAttribute('aria-selected','true');
        tabU19.classList.remove('tab-active'); tabU19.setAttribute('aria-selected','false');
      } else {
        tabU19.classList.add('tab-active'); tabU19.setAttribute('aria-selected','true');
        tabU14.classList.remove('tab-active'); tabU14.setAttribute('aria-selected','false');
      }
      renderFixtures(lastDocs);
    }
    tabU14.addEventListener('click', ()=> setActiveTab('U14'));
    tabU19.addEventListener('click', ()=> setActiveTab('U19'));

    function escapeHtml(s){ if(s === null || typeof s === 'undefined') return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    let lastDocs = [];
    try {
      const ref = collection(db, FIXTURES_COLLECTION_PATH);
      const q = query(ref);
      onSnapshot(q, (snap) => {
        lastDocs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        lastDocs.sort((a,b) => {
          const ta = a.kickoffISO ? new Date(a.kickoffISO).getTime() : (a.createdAt?.seconds ? a.createdAt.seconds*1000 : 0);
          const tb = b.kickoffISO ? new Date(b.kickoffISO).getTime() : (b.createdAt?.seconds ? b.createdAt.seconds*1000 : 0);
          return ta - tb;
        });
        renderFixtures(lastDocs);
      }, (err) => {
        console.error('fixtures onSnapshot error', err);
        fixturesList.innerHTML = '<div class="text-red-600">Could not load fixtures.</div>';
      });
    } catch (err) {
      console.error('Failed to attach fixtures listener', err);
      fixturesList.innerHTML = '<div class="text-red-600">Could not load fixtures.</div>';
    }

    function formatKickoff(f) {
      try {
        if (f.kickoffISO) return new Date(f.kickoffISO).toLocaleString();
        if (f.kickoffTs && f.kickoffTs.seconds) return new Date(f.kickoffTs.seconds*1000).toLocaleString();
      } catch(e){}
      return '';
    }

    function renderFixtures(docs) {
      fixturesList.innerHTML = '';
      const filtered = docs.filter(f => {
        const ag = (f.ageGroup || '').toLowerCase();
        if (!ag) return false;
        if (currentTab === 'U14') return ag === 'u14' || ag === 'u/14' || ag.includes('14');
        if (currentTab === 'U19') return ag === 'u19' || ag === 'u/19' || ag.includes('19');
        return true;
      });

      if (!filtered.length) {
        fixturesList.innerHTML = `<div class="text-gray-500">No ${escapeHtml(currentTab)} fixtures yet.</div>`;
        return;
      }

      filtered.forEach(f => {
        const kickoff = formatKickoff(f);
        const scorePresent = (typeof f.scoreHome !== 'undefined' && typeof f.scoreAway !== 'undefined' && f.scoreHome !== null && f.scoreAway !== null);

        const teamALogo = escapeHtml(f.teamALogoUrl || 'images/opponent.png');
        const teamBLogo = escapeHtml(f.teamBLogoUrl || 'images/opponent.png');
        const shouldShowWatch = !!(f.streamUrl && String(f.streamUrl).trim());

        const wrapper = document.createElement('div');
        wrapper.className = 'fixture-card';
        wrapper.innerHTML = `
          <div style="display:flex;align-items:center;gap:12px;">
            <img class="team-logo" src="${teamALogo}" alt="${escapeHtml(f.teamA||'Team A')}"/>
            <div style="font-weight:700;">${escapeHtml(f.teamA || 'Team A')}</div>
          </div>

          <div style="text-align:center;">
            <div class="fixture-meta">${escapeHtml(kickoff)} ${ f.venue ? ' · ' + escapeHtml(f.venue) : '' }</div>
            <div style="margin-top:6px;">
              ${ scorePresent ? `<span class="score">${escapeHtml(String(f.scoreHome))}</span> <span style="color:#6b7280;font-weight:700;margin:0 .5rem;">:</span> <span class="score">${escapeHtml(String(f.scoreAway))}</span>` : '<span style="color:#9CA3AF;font-weight:800;">vs</span>' }
            </div>
            <div class="fixture-meta" style="margin-top:6px;">${escapeHtml(f.broadcast || '')}</div>
          </div>

          <div style="display:flex;align-items:center;gap:12px;justify-content:flex-end;">
            <div style="font-weight:700;text-align:right;">${escapeHtml(f.teamB || 'Team B')}</div>
            <img class="team-logo" src="${teamBLogo}" alt="${escapeHtml(f.teamB||'Team B')}"/>
          </div>

          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px;">
            <div class="fixture-meta">${escapeHtml(f.ageGroup || '')} · ${escapeHtml(f.status || '')}</div>
            ${ shouldShowWatch ? `<a class="watch-btn" href="${escapeHtml(f.streamUrl)}" target="_blank" rel="noopener noreferrer">Watch</a>` : `<div style="height:36px;"></div>` }
          </div>
        `;
        fixturesList.appendChild(wrapper);
      });
    }

    // default tab
    setActiveTab('U14');
  </script>
</body>
</html>
