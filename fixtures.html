<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fixtures & Live Scores | The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="data:,">
</head>
<body class="bg-pink-50 text-black font-sans min-h-screen flex flex-col">
  <!-- Header -->
  <header class="fixed top-0 w-full flex justify-between items-center px-6 py-4 bg-pink-100 shadow z-50">
    <h1 class="text-xl font-bold uppercase text-rose-600">The Footballer’s Sister</h1>
    <nav class="space-x-6">
      <a href="index.html" class="hover:underline text-rose-600">Home</a>
      <a href="bts.html" class="hover:underline text-rose-600">Behind the Game</a>
      <a href="questions.html" class="hover:underline text-rose-600">Q&A</a>
      <a href="support-wall.html" class="hover:underline text-rose-600">Support Wall</a>
      <a href="fixtures.html" class="font-semibold underline text-rose-600">Fixtures</a>
    </nav>
  </header>

  <!-- Main -->
  <main class="flex-grow pt-32 px-6 pb-20 max-w-4xl mx-auto">
    <h2 class="text-4xl font-bold mb-2 text-rose-700 text-center">Jomo Cosmos Fixtures & Live Scores</h2>
    <p class="text-sm text-gray-600 text-center mb-8">U14 & U19 only • auto-updates in real time</p>

    <!-- Filters -->
    <div class="flex flex-wrap gap-2 justify-center mb-6">
      <button class="px-4 py-2 rounded-full bg-rose-600 text-white" data-level="all">All</button>
      <button class="px-4 py-2 rounded-full bg-gray-200 text-gray-900" data-level="U14">U14</button>
      <button class="px-4 py-2 rounded-full bg-gray-200 text-gray-900" data-level="U19">U19</button>
      <button class="px-4 py-2 rounded-full bg-gray-200 text-gray-900" data-status="scheduled">Scheduled</button>
      <button class="px-4 py-2 rounded-full bg-gray-200 text-gray-900" data-status="live">Live</button>
      <button class="px-4 py-2 rounded-full bg-gray-200 text-gray-900" data-status="finished">Finished</button>
      <button id="clearFilters" class="px-4 py-2 rounded-full bg-gray-100">Clear Filters</button>
    </div>

    <!-- Lists -->
    <section class="grid md:grid-cols-2 gap-6">
      <div>
        <h3 class="text-xl font-semibold text-rose-700 mb-3">Upcoming</h3>
        <div id="listUpcoming" class="space-y-3"></div>
      </div>
      <div>
        <h3 class="text-xl font-semibold text-rose-700 mb-3">Live & Results</h3>
        <div id="listLive" class="space-y-3"></div>
      </div>
    </section>
  </main>

  <footer class="bg-pink-900 text-white text-center py-6">
    <p>&copy; <span id="year"></span> The Footballer’s Sister. All rights reserved.</p>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const appId = "1:65396604482:web:0f31625a714aa8352337db";
    const FIXTURES_PATH = `artifacts/${appId}/public/data/fixtures`;

    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    signInAnonymously(auth).catch(console.error);

    const listUpcoming = document.getElementById('listUpcoming');
    const listLive = document.getElementById('listLive');

    let filterLevel = 'all';      // 'all' | 'U14' | 'U19'
    let filterStatus = null;      // null | 'scheduled' | 'live' | 'finished'
    let allFixtures = [];

    const btns = document.querySelectorAll('[data-level], [data-status]');
    btns.forEach(b=>{
      b.addEventListener('click', ()=>{
        btns.forEach(x=>x.classList.remove('bg-rose-600','text-white'));
        b.classList.add('bg-rose-600','text-white');
        if (b.dataset.level) { filterLevel = b.dataset.level; filterStatus=null; }
        if (b.dataset.status){ filterStatus = b.dataset.status; filterLevel='all'; }
        render();
      });
    });
    document.getElementById('clearFilters').onclick = ()=>{
      filterLevel='all'; filterStatus=null; render();
      btns.forEach(x=>x.classList.remove('bg-rose-600','text-white'));
      document.querySelector('[data-level="all"]').classList.add('bg-rose-600','text-white');
    };

    onSnapshot(query(collection(db, FIXTURES_PATH), orderBy('kickoffTs','asc')), (snap)=>{
      allFixtures = snap.docs.map(d=>({id:d.id, ...d.data()}));
      render();
    });

    function render() {
      const filt = allFixtures.filter(f=>{
        const byLevel = (filterLevel==='all') || f.level===filterLevel;
        const byStatus = !filterStatus || f.status===filterStatus;
        return byLevel && byStatus;
      });

      const now = Date.now();
      const upcoming = filt.filter(f=>f.status==='scheduled' && (f.kickoffTs ? f.kickoffTs.toMillis?.() ?? f.kickoffTs : Infinity) >= 0);
      const liveOrDone = filt.filter(f=>f.status!=='scheduled');

      listUpcoming.innerHTML = upcoming.length ? '' : `<p class="text-gray-500 text-sm">No upcoming fixtures.</p>`;
      upcoming.forEach(f=>listUpcoming.appendChild(card(f)));

      listLive.innerHTML = liveOrDone.length ? '' : `<p class="text-gray-500 text-sm">No live or finished games.</p>`;
      liveOrDone.forEach(f=>listLive.appendChild(card(f)));
    }

    function card(f) {
      const el = document.createElement('div');
      el.className = 'p-4 bg-white rounded-xl shadow border';
      const dt = f.kickoffTs?.toDate ? f.kickoffTs.toDate() : (f.kickoffTs ? new Date(f.kickoffTs) : null);
      const when = dt ? dt.toLocaleString() : `${f.date||''} ${f.time||''}`;
      const score = (f.status==='finished' || f.status==='live') ? ` — <strong>${f.scoreHome ?? 0} : ${f.scoreAway ?? 0}</strong>` : '';
      const streamBtn = f.streamUrl ? `<a target="_blank" href="${f.streamUrl}" class="ml-2 inline-block px-3 py-1 rounded-full text-sm bg-rose-600 text-white hover:bg-rose-700">Watch live</a>` : '';
      const badge =
        f.status==='live' ? `<span class="ml-2 px-2 py-0.5 text-xs rounded-full bg-green-100 text-green-700">LIVE</span>` :
        f.status==='finished' ? `<span class="ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-100 text-gray-700">FT</span>` :
        `<span class="ml-2 px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-700">Scheduled</span>`;

      el.innerHTML = `
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-sm text-gray-500">${when} • ${f.venue || ''}</div>
            <div class="text-lg font-semibold text-gray-900 mt-1">
              Jomo Cosmos ${f.level || ''} ${f.homeAway==='home' ? '(Home)' : '(Away)'} vs ${f.opponent || ''}
              ${badge} ${score}
            </div>
            <div class="text-sm text-gray-600 mt-1">${f.competition || ''}</div>
            <div class="mt-2">${streamBtn}</div>
          </div>
        </div>
      `;
      return el;
    }
  </script>
</body>
</html>
