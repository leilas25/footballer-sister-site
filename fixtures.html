<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fixtures & Live Scores – The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .logo { width: 48px; height: 48px; border-radius: 9999px; object-fit: cover; background:#f1f5f9; border:1px solid #f3d3e2; }
    .chip { font-size:.75rem; padding:.15rem .5rem; border-radius:9999px }
    .chip-blue { background:#e0f2fe; color:#075985 }
    .chip-green{ background:#dcfce7; color:#166534 }
    .chip-gray { background:#e5e7eb; color:#374151 }

    /* Layout for fixture card similar to screenshot */
    .fixture-card { background:white; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); padding:18px; border:1px solid #f3d3e2; overflow:hidden; }
    .fixture-top { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .teams { display:flex; align-items:center; gap:12px; }
    .team { display:flex; align-items:center; gap:8px; min-width:120px; }
    .kickoff { font-weight:700; font-size:1.1rem; }
    .catch-strip { margin-top:12px; background:#fff0f6; border-top:1px solid #f7d6e8; padding:12px; border-radius:8px; color:#be185d; font-weight:700; }
    .age-section { margin-top:2rem; }
    .age-title { font-weight:800; color:#be185d; margin-bottom:.75rem; font-size:1.1rem; }

    /* Dropdown open helper (used by the navbar script) */
    .dropdown-open { opacity:1!important; transform:scale(1)!important; }
  </style>
</head>
<body class="bg-pink-50 text-black font-sans min-h-screen">

  <!-- Header with dropdown (replaces previous header) -->
  <header class="fixed top-0 w-full bg-pink-100 shadow z-50">
    <div class="flex justify-between items-center px-6 py-4">
      <h1 class="text-xl font-bold uppercase text-rose-600">THE FOOTBALLER’S SISTER</h1>

      <div class="relative inline-block text-left">
        <button id="navButton"
          class="inline-flex justify-center w-full rounded-md border border-pink-200 shadow-sm px-4 py-2 bg-white text-sm font-medium text-rose-600 hover:bg-pink-50 focus:outline-none">
          <span id="navTitle">Loading...</span>
          <svg class="-mr-1 ml-2 h-5 w-5 text-rose-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
          </svg>
        </button>

        <div id="dropdownMenu"
          class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 transform transition-all duration-200 ease-out scale-95 opacity-0">
          <div class="py-1">
            <a href="index.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Home</a>
            <a href="bts.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Behind the Game</a>
            <a href="leila.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Meet Leila</a>
            <a href="questions.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Q&A</a>
            <a href="support-wall.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Support Wall</a>
            <a href="fixtures.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Fixtures & Live Scores</a>
            <a href="giveaways.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Giveaways</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="pt-24 px-6 max-w-6xl mx-auto pb-24">
    <h2 class="text-4xl font-extrabold text-center text-rose-700">Fixtures & Live Scores</h2>
    <p class="text-center text-gray-600 mt-1">U14 &amp; U19 • Jomo Cosmos</p>

    <div id="contentArea" class="mt-8">
      <div id="u19Section" class="age-section"></div>
      <div id="u14Section" class="age-section"></div>
      <div id="seniorSection" class="age-section"></div>
    </div>

    <div id="emptyMsg" class="text-center text-gray-500 mt-8 hidden">No fixtures yet.</div>
  </main>

  <footer class="bg-pink-900 text-white text-center py-6">
    <p>&copy; <span id="year"></span> The Footballer’s Sister. All rights reserved.</p>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- Navbar dropdown script -->
  <script>
    (function () {
      const navButton = document.getElementById('navButton');
      const dropdownMenu = document.getElementById('dropdownMenu');
      const navItems = document.querySelectorAll('.nav-item');
      const navTitle = document.getElementById('navTitle');

      // determine current page (treat root "/" as index.html)
      let currentPage = window.location.pathname.split('/').pop();
      if (!currentPage || currentPage === '') currentPage = 'index.html';

      const pageTitles = {
        "index.html": "Home",
        "bts.html": "Behind the Game",
        "leila.html": "Meet Leila",
        "questions.html": "Q&A",
        "support-wall.html": "Support Wall",
        "fixtures.html": "Fixtures & Live Scores"
      };
      navTitle.textContent = pageTitles[currentPage] || "Menu";

      navItems.forEach(link => {
        const href = link.getAttribute('href');
        // normalize href (in case it is '/index.html' etc)
        const hrefName = href.split('/').pop();
        if (hrefName === currentPage) {
          link.classList.add("font-semibold", "text-rose-600");
        }
      });

      navButton.addEventListener('click', (e) => {
        e.stopPropagation();
        const isHidden = dropdownMenu.classList.contains('hidden');
        if (isHidden) {
          dropdownMenu.classList.remove('hidden');
          // slight delay to allow CSS transition from scale-95/opacity-0 -> scale-100/opacity-1
          setTimeout(()=>dropdownMenu.classList.add('dropdown-open'), 10);
        } else {
          dropdownMenu.classList.remove('dropdown-open');
          setTimeout(()=>dropdownMenu.classList.add('hidden'), 200);
        }
      });

      // close when clicking outside
      document.addEventListener('click', (e) => {
        if (!navButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
          dropdownMenu.classList.remove('dropdown-open');
          setTimeout(()=>dropdownMenu.classList.add('hidden'), 200);
        }
      });

      // close on escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          dropdownMenu.classList.remove('dropdown-open');
          setTimeout(()=>dropdownMenu.classList.add('hidden'), 200);
        }
      });
    })();
  </script>

  <!-- Firebase + page logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const APP_ID = firebaseConfig.appId;
    const FIXTURES_PATH = `artifacts/${APP_ID}/public/data/fixtures`;
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const u19Section = document.getElementById('u19Section');
    const u14Section = document.getElementById('u14Section');
    const seniorSection = document.getElementById('seniorSection');
    const emptyMsg = document.getElementById('emptyMsg');

    const JC_U14 = "/images/jc-u14.png";
    const JC_U19 = "/images/jc-u19.png";
    const OPP    = "/images/opponent.png";

    function esc(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    function makeFixtureCard(f) {
      const kickoffISO = f.kickoffISO || f.kickoffLabel || '';
      const kickoffText = kickoffISO ? new Date(kickoffISO).toLocaleString() : '';
      const teamALogo = f.teamALogoUrl || (f.ageGroup === 'U14' ? JC_U14 : (f.ageGroup === 'U19' ? JC_U19 : OPP));
      const teamBLogo = f.teamBLogoUrl || OPP;
      const broadcast = f.broadcast || '';
      const el = document.createElement('div');
      el.className = 'fixture-card';
      el.innerHTML = `
        <div class="fixture-top">
          <div class="teams">
            <div class="team">
              <img class="logo" src="${esc(teamALogo)}" onerror="this.onerror=null;this.src='${JC_U19}'"/>
              <div class="text-left">
                <div style="font-weight:800">${esc(f.teamA || 'Team A')}</div>
              </div>
            </div>

            <div class="kickoff">${esc(f.kickoffISO ? new Date(f.kickoffISO).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '')}</div>

            <div class="team">
              <div class="text-right">
                <div style="font-weight:800">${esc(f.teamB || 'Team B')}</div>
              </div>
              <img class="logo" src="${esc(teamBLogo)}" onerror="this.onerror=null;this.src='${OPP}'"/>
            </div>
          </div>

          <div style="text-align:center;min-width:180px;">
            <div style="font-size:.95rem;color:#6b7280">${esc(f.venue || '')}</div>
            <div style="margin-top:.25rem;font-size:.95rem;color:#374151">${esc(f.ageGroup || '')} · ${esc(f.status || '')}</div>
          </div>
        </div>

        ${ broadcast ? `<div class="catch-strip">${esc(broadcast)}</div>` : '' }

        ${ f.streamUrl ? `<div style="margin-top:12px;"><a class="inline-block px-4 py-2 rounded bg-rose-600 text-white" href="${esc(f.streamUrl)}" target="_blank" rel="noopener">Watch</a></div>` : '' }
      `;
      return el;
    }

    (async () => {
      try {
        const q = query(collection(db, FIXTURES_PATH), orderBy('kickoffISO', 'asc'));
        onSnapshot(q, snap => {
          const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
          // group by age
          const u19 = docs.filter(x => (x.ageGroup || '').toUpperCase() === 'U19');
          const u14 = docs.filter(x => (x.ageGroup || '').toUpperCase() === 'U14');
          const senior = docs.filter(x => ((x.ageGroup || '').toUpperCase() !== 'U19' && (x.ageGroup || '').toUpperCase() !== 'U14'));

          u19Section.innerHTML = '';
          u14Section.innerHTML = '';
          seniorSection.innerHTML = '';
          let total = 0;

          if (u19.length) {
            total += u19.length;
            const h = document.createElement('div');
            h.className = 'age-title';
            h.textContent = 'U19 Fixtures';
            u19Section.appendChild(h);
            u19.forEach(f => u19Section.appendChild(makeFixtureCard(f)));
          }

          if (u14.length) {
            total += u14.length;
            const h = document.createElement('div');
            h.className = 'age-title';
            h.textContent = 'U14 Fixtures';
            u14Section.appendChild(h);
            u14.forEach(f => u14Section.appendChild(makeFixtureCard(f)));
          }

          if (senior.length) {
            total += senior.length;
            const h = document.createElement('div');
            h.className = 'age-title';
            h.textContent = 'Senior / Others';
            seniorSection.appendChild(h);
            senior.forEach(f => seniorSection.appendChild(makeFixtureCard(f)));
          }

          emptyMsg.classList.toggle('hidden', total > 0);
        });
      } catch (err) {
        console.error('fixtures load error', err);
        document.getElementById('contentArea').innerHTML = '<div class="text-red-600">Could not load fixtures.</div>';
      }
    })();
  </script>
</body>
</html>
