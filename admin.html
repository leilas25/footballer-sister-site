<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ADMIN • The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small css helpers */
    .card { background:#fff; border-radius:12px; padding:20px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    .btn { padding:.6rem 1rem; border-radius:9999px; font-weight:600; }
    .small-muted { font-size:.95rem; color:#7a7a7a; }
    .hidden-el { display:none !important; }
    body { -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
  </style>
</head>
<body class="bg-pink-50 font-sans text-black">

  <!-- Header -->
  <header class="bg-pink-100 sticky top-0 z-40 shadow">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <h1 class="text-xl font-bold uppercase text-rose-600">ADMIN • THE FOOTBALLER’S SISTER</h1>
      <a href="index.html" class="text-rose-600 hover:underline">Home</a>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-6 py-8">
    <!-- LOGIN ONLY (visible by default) -->
    <section id="loginSection" class="card mx-auto max-w-md">
      <h2 class="text-2xl font-bold text-rose-700 mb-3">Admin sign-in</h2>
      <p class="small-muted mb-4">Enter the admin email & password. No admin content will be shown until the correct admin signs in.</p>

      <form id="loginForm" class="grid gap-3">
        <input id="email" type="email" placeholder="Admin email" autocomplete="username" required class="p-3 rounded border" />
        <input id="password" type="password" placeholder="Password" autocomplete="current-password" required class="p-3 rounded border" />
        <div class="flex gap-3">
          <button id="signInBtn" type="submit" class="btn bg-rose-600 text-white">Sign in</button>
          <button id="cancelBtn" type="button" class="btn bg-white border" onclick="document.getElementById('email').value='';document.getElementById('password').value='';">Clear</button>
        </div>
      </form>

      <p id="loginMessage" class="mt-3 small-muted"></p>
    </section>

    <!-- ADMIN UI: completely hidden until admin verified (do not remove the hidden class) -->
    <section id="adminUI" class="hidden-el" aria-hidden="true">
      <!-- top nav -->
      <div class="flex gap-3 items-center mb-6">
        <button id="navSupport" class="rounded-full bg-white px-4 py-2 shadow-sm small-muted">Support Wall</button>
        <button id="navQA" class="rounded-full bg-white px-4 py-2 shadow-sm small-muted">Q&A</button>
        <button id="navFixtures" class="rounded-full bg-white px-4 py-2 shadow-sm small-muted">Fixtures</button>
        <button id="navMedia" class="rounded-full bg-white px-4 py-2 shadow-sm small-muted">Media / Gallery</button>
        <button id="navGiveaways" class="rounded-full bg-white px-4 py-2 shadow-sm small-muted">Giveaways</button>
        <button id="navWinners" class="rounded-full bg-white px-4 py-2 shadow-sm small-muted">Winners</button>

        <div class="ml-auto text-sm small-muted">
          Signed in as <span id="adminEmailDisplay"></span>
          <button id="signOutBtn" class="btn bg-rose-600 text-white ml-4">Log out</button>
        </div>
      </div>

      <!-- Example admin area (this will appear only after correct admin sign-in) -->
      <div id="adminContent" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="card">
          <h3 class="text-xl font-bold mb-3 text-rose-700">Media / Gallery (admin)</h3>
          <p class="small-muted">Manage gallery items here.</p>
          <div id="galleryItems" class="mt-4 small-muted">(gallery will appear here)</div>
        </div>

        <div class="card">
          <h3 class="text-xl font-bold mb-3 text-rose-700">Winners (admin)</h3>
          <p class="small-muted">Manage winners here.</p>
          <div id="winnersList" class="mt-4 small-muted">(winners will appear here)</div>
        </div>
      </div>
    </section>

  </main>

  <footer class="bg-pink-900 text-white text-center py-6">
    <p>&copy; 2025 The Footballer’s Sister. All rights reserved.</p>
  </footer>

  <!-- Firebase script (module) -->
  <script type="module">
    // ---------- CONFIG ----------
    // Admin UID must match exactly this value to reveal admin UI
    const ADMIN_UID = "pDokgebzpTZWzmn9dW50kaDAqRT2";

    // Your Firebase config (unchanged)
    const appId = '1:65396604482:web:0f31625a714aa8352337db';
    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: appId
    };

    // ---------- IMPORTS ----------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // ---------- INITIALIZE ----------
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app); // keep available but do not attach any listeners until admin validated

    // ---------- ELEMENTS ----------
    const loginSection = document.getElementById('loginSection');
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginMessage = document.getElementById('loginMessage');

    const adminUI = document.getElementById('adminUI');
    const adminEmailDisplay = document.getElementById('adminEmailDisplay');
    const signOutBtn = document.getElementById('signOutBtn');

    // These containers will be used after admin validation
    const galleryItems = document.getElementById('galleryItems');
    const winnersList = document.getElementById('winnersList');

    // ---------- UTILS ----------
    function hideAllAdminUI() {
      adminUI.classList.add('hidden-el');
      adminUI.setAttribute('aria-hidden', 'true');
    }
    function revealAdminUI(user) {
      adminEmailDisplay.textContent = user.email || '(no email)';
      adminUI.classList.remove('hidden-el');
      adminUI.removeAttribute('aria-hidden');
    }

    // Start hidden (defensive)
    hideAllAdminUI();

    // ---------- SIGN IN HANDLER ----------
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      loginMessage.textContent = 'Signing in...';
      try {
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        if (!email || !password) { loginMessage.textContent = 'Enter both email and password.'; return; }

        // attempt sign in
        await signInWithEmailAndPassword(auth, email, password);
        // Do NOT reveal anything here — onAuthStateChanged will handle the result and verify UID.
      } catch (err) {
        console.error('Sign-in error', err);
        loginMessage.textContent = 'Sign-in failed: ' + (err.message || 'Unknown error');
      }
    });

    // ---------- AUTH STATE WATCHER ----------
    // This will immediately enforce that only the exact ADMIN_UID reveals the UI.
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        // not signed in: keep login shown and hide admin UI
        loginMessage.textContent = '';
        hideAllAdminUI();
        return;
      }

      // user is signed in -> check UID
      if (user.uid === ADMIN_UID) {
        // correct admin: reveal admin UI now (and you can safely attach listeners here)
        loginMessage.textContent = '';
        loginSection.classList.add('hidden-el'); // hide login card once admin validated
        revealAdminUI(user);

        // IMPORTANT: attach your Firestore listeners / admin logic here.
        // For safety this file does NOT automatically attach any write listeners.
        // Example placeholders (do not attach anything if you haven't set Firestore rules):
        galleryItems.textContent = '(admin: gallery will load here)';
        winnersList.textContent = '(admin: winners will load here)';

        // If you want, I can add the listeners and upload logic now — tell me and I will paste them.
      } else {
        // signed in as non-admin -> immediately sign them out and show a message (do not reveal UI)
        try {
          await signOut(auth);
        } catch (err) {
          console.error('Sign-out after non-admin sign-in failed', err);
        }
        hideAllAdminUI();
        loginMessage.textContent = 'Signed-in account is not the admin. You have been signed out.';
      }
    });

    // ---------- SIGN OUT BUTTON ----------
    signOutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
        // always return to login view
        loginMessage.textContent = 'Signed out.';
        hideAllAdminUI();
        loginSection.classList.remove('hidden-el');
      } catch (err) {
        console.error('Sign-out error', err);
        loginMessage.textContent = 'Sign-out failed: ' + (err.message || '');
      }
    });

    // Safety: ensure page starts with login visible and admin hidden
    hideAllAdminUI();
    document.getElementById('loginSection').classList.remove('hidden-el');
  </script>
</body>
</html>
