<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin • The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .pill { padding: .5rem 1rem; border-radius: 9999px; background:#f1f5f9; color:#334155; display:inline-block; }
    .active-pill { background:#d9467a; color:white; }
    .hidden { display:none; }
  </style>
</head>
<body class="bg-pink-50">

  <header class="bg-pink-100 fixed top-0 left-0 right-0 z-40">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold text-rose-600">ADMIN • THE FOOTBALLER’S SISTER</h1>
      <a href="index.html" class="text-rose-600">Home</a>
    </div>
  </header>

  <main class="pt-28 max-w-6xl mx-auto px-6 pb-20">
    <div class="flex gap-4 items-center mb-6">
      <button id="tab-support" class="pill">Support Wall</button>
      <button id="tab-questions" class="pill">Q&A</button>
      <button id="tab-fixtures" class="pill">Fixtures</button>
      <button id="tab-gallery" class="pill active-pill">Media / Gallery</button>
      <button id="tab-giveaways" class="pill">Giveaways</button>
      <button id="tab-winners" class="pill">Winners</button>
      <div class="ml-auto text-sm text-gray-600" id="uidDisplay">UID: Loading...</div>
      <button id="logoutBtn" class="ml-4 bg-rose-600 text-white px-4 py-2 rounded-full">Log out</button>
    </div>

    <!-- Generic status -->
    <div id="status" class="mb-6 text-sm text-red-600"></div>

    <!-- -------------- SUPPORT WALL (keeps same) -------------- -->
    <section id="supportSection" class="">
      <h2 class="text-2xl font-bold text-rose-700 mb-4">Support Wall — Manage</h2>
      <p class="text-sm text-gray-700 mb-3">This re-uses your supportMessages collection — works as before.</p>
      <div id="supportList" class="space-y-3 mb-12"></div>
    </section>

    <!-- -------------- Q&A (keeps same) -------------- -->
    <section id="questionsSection" class="hidden">
      <h2 class="text-2xl font-bold text-rose-700 mb-4">Q&A — Manage</h2>
      <div id="questionsList" class="space-y-3 mb-12"></div>
    </section>

    <!-- -------------- FIXTURES -------------- -->
    <section id="fixturesSection" class="hidden">
      <h2 class="text-2xl font-bold text-rose-700 mb-4">Fixtures — Add / Edit</h2>

      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <form id="fixtureForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-gray-700">Home Team</label>
            <input id="fixtureHome" class="w-full border px-3 py-2 rounded" placeholder="Jomo Cosmos U14" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Away Team</label>
            <input id="fixtureAway" class="w-full border px-3 py-2 rounded" placeholder="Kaizer Chiefs U14" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Date & Time</label>
            <input id="fixtureDate" type="datetime-local" class="w-full border px-3 py-2 rounded" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Stadium</label>
            <input id="fixtureStadium" class="w-full border px-3 py-2 rounded" placeholder="Rand stadium" />
          </div>

          <div>
            <label class="block text-sm text-gray-700">Level</label>
            <select id="fixtureLevel" class="w-full border px-3 py-2 rounded">
              <option>U14</option><option>U17</option><option>U19</option>
            </select>
          </div>
          <div>
            <label class="block text-sm text-gray-700">Status</label>
            <select id="fixtureStatus" class="w-full border px-3 py-2 rounded">
              <option>Scheduled</option><option>Played</option><option>Cancelled</option>
            </select>
          </div>

          <div>
            <label class="block text-sm text-gray-700">Home team logo (file)</label>
            <input id="homeLogoFile" type="file" accept="image/*" class="mt-1" />
            <button type="button" id="uploadHomeLogoBtn" class="mt-2 bg-rose-600 text-white px-3 py-2 rounded">Upload Home Logo</button>
            <div id="homeLogoPreview" class="mt-2 text-sm text-gray-600"></div>
          </div>
          <div>
            <label class="block text-sm text-gray-700">Away team logo (file)</label>
            <input id="awayLogoFile" type="file" accept="image/*" class="mt-1" />
            <button type="button" id="uploadAwayLogoBtn" class="mt-2 bg-rose-600 text-white px-3 py-2 rounded">Upload Away Logo</button>
            <div id="awayLogoPreview" class="mt-2 text-sm text-gray-600"></div>
          </div>

          <div class="md:col-span-2 flex gap-3">
            <button id="saveFixture" type="button" class="bg-rose-600 text-white px-6 py-2 rounded">Save Fixture</button>
            <button id="resetFixture" type="button" class="bg-gray-100 px-4 py-2 rounded">Reset</button>
          </div>
        </form>
      </div>

      <div>
        <h3 class="text-lg font-semibold mb-2">Existing Fixtures</h3>
        <div id="fixturesList" class="space-y-3"></div>
      </div>
    </section>

    <!-- -------------- GALLERY / BTS -------------- -->
    <section id="gallerySection">
      <h2 class="text-2xl font-bold text-rose-700 mb-4">Media / Gallery — Upload & Manage</h2>

      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <form id="galleryForm" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
          <div>
            <label class="block text-sm text-gray-700">Choose image</label>
            <input id="galleryFile" type="file" accept="image/*" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Caption</label>
            <input id="galleryCaption" class="w-full border px-3 py-2 rounded" placeholder="Short caption (e.g., 'Pre-match shoot')" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Order (smaller shows first)</label>
            <input id="galleryOrder" type="number" value="1" class="w-full border px-3 py-2 rounded" />
          </div>

          <div class="md:col-span-3">
            <button id="uploadGalleryBtn" type="button" class="bg-rose-600 text-white px-6 py-2 rounded">Upload to Cloud & Save</button>
            <button id="resetGalleryBtn" type="button" class="ml-3 bg-gray-100 px-4 py-2 rounded">Reset</button>
          </div>

          <div class="md:col-span-3 mt-4">
            <div id="galleryProgress" class="w-full h-2 bg-gray-200 rounded overflow-hidden"><div id="galleryProgressFill" style="width:0%" class="h-full bg-rose-600"></div></div>
          </div>
        </form>
      </div>

      <div>
        <h3 class="text-lg font-semibold mb-2">Gallery Items</h3>
        <div id="galleryList" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
      </div>
    </section>

    <!-- -------------- GIVEAWAYS -------------- -->
    <section id="giveawaysSection" class="hidden">
      <h2 class="text-2xl font-bold text-rose-700 mb-4">Giveaways — Add / Manage</h2>

      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm text-gray-700">Title</label>
            <input id="giveTitle" class="w-full border px-3 py-2 rounded" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Prize</label>
            <input id="givePrize" class="w-full border px-3 py-2 rounded" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Ends at</label>
            <input id="giveEnds" type="datetime-local" class="w-full border px-3 py-2 rounded" />
          </div>

          <div class="md:col-span-3">
            <button id="saveGiveaway" class="bg-rose-600 text-white px-6 py-2 rounded">Create Giveaway</button>
            <button id="resetGiveaway" class="ml-3 bg-gray-100 px-4 py-2 rounded">Reset</button>
          </div>
        </div>
      </div>

      <div>
        <h3 class="text-lg font-semibold mb-2">Existing Giveaways</h3>
        <div id="giveawaysList" class="space-y-3"></div>
      </div>
    </section>

    <!-- -------------- WINNERS -------------- -->
    <section id="winnersSection" class="hidden">
      <h2 class="text-2xl font-bold text-rose-700 mb-4">Winners — Add / Manage</h2>

      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <form id="winnerForm" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
          <div>
            <label class="block text-sm text-gray-700">Winner Name</label>
            <input id="winnerName" class="w-full border px-3 py-2 rounded" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Handle (IG/TikTok)</label>
            <input id="winnerHandle" class="w-full border px-3 py-2 rounded" />
          </div>
          <div>
            <label class="block text-sm text-gray-700">Prize</label>
            <input id="winnerPrize" class="w-full border px-3 py-2 rounded" />
          </div>

          <div>
            <label class="block text-sm text-gray-700">Announced At</label>
            <input id="winnerAnnouncedAt" type="date" class="w-full border px-3 py-2 rounded"/>
          </div>
          <div>
            <label class="block text-sm text-gray-700">Upload Picture</label>
            <input id="winnerFile" type="file" accept="image/*" />
          </div>

          <div class="md:col-span-3">
            <button id="saveWinner" type="button" class="bg-rose-600 text-white px-6 py-2 rounded">Save Winner</button>
            <button id="resetWinner" type="button" class="ml-3 bg-gray-100 px-4 py-2 rounded">Reset</button>
          </div>
        </form>
      </div>

      <div>
        <h3 class="text-lg font-semibold mb-2">Winners List</h3>
        <div id="winnersList" class="space-y-3"></div>
      </div>
    </section>
  </main>

  <footer class="fixed bottom-0 left-0 right-0 bg-pink-900 text-white text-center py-3">© 2025 The Footballer’s Sister</footer>

  <!-- Firebase + logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- CONFIG — replace if different project (kept as you provided) ---
    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const ARTIFACT_ID = "1:65396604482:web:0f31625a714aa8352337db"; // collection base used in rules and client
    const CLOUD_NAME = "dk1df1qmi"; // supplied by you
    const CLOUDINARY_UPLOAD_PRESET = "unsigned_bts_preset"; // supplied by you
    const ADMIN_UID = "pDokgebzpTZWzmn9dW50kaDAqRT2"; // your admin UID

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ui refs
    const uidDisplay = document.getElementById('uidDisplay');
    const statusEl = document.getElementById('status');

    // tabs
    const sections = {
      support: document.getElementById('supportSection'),
      questions: document.getElementById('questionsSection'),
      fixtures: document.getElementById('fixturesSection'),
      gallery: document.getElementById('gallerySection'),
      giveaways: document.getElementById('giveawaysSection'),
      winners: document.getElementById('winnersSection'),
    };

    function switchTo(tab){
      Object.values(sections).forEach(s => s.classList.add('hidden'));
      sections[tab].classList.remove('hidden');
      // update pills
      document.querySelectorAll('.pill').forEach(b => b.classList.remove('active-pill'));
      document.getElementById('tab-' + tab).classList.add('active-pill');
    }

    document.getElementById('tab-support').addEventListener('click', ()=>switchTo('support'));
    document.getElementById('tab-questions').addEventListener('click', ()=>switchTo('questions'));
    document.getElementById('tab-fixtures').addEventListener('click', ()=>switchTo('fixtures'));
    document.getElementById('tab-gallery').addEventListener('click', ()=>switchTo('gallery'));
    document.getElementById('tab-giveaways').addEventListener('click', ()=>switchTo('giveaways'));
    document.getElementById('tab-winners').addEventListener('click', ()=>switchTo('winners'));

    document.getElementById('logoutBtn').addEventListener('click', ()=> signOut(auth));

    // ensure admin: sign in anonymously if needed — if your admin uses a custom token you should sign in that way.
    onAuthStateChanged(auth, user => {
      if (!user) {
        // try anonymous sign-in to be able to read public docs. Admin should be a known UID (custom auth) in your environment.
        signInAnonymously(auth).catch(e => console.error(e));
        uidDisplay.textContent = "UID: (signing in...)";
        return;
      }
      uidDisplay.textContent = `UID: ${user.uid}`;
      if (user.uid !== ADMIN_UID) {
        // not admin — show warning but still allow read-only where rules permit
        statusEl.textContent = "You are signed in but not as the admin account. Writes will be blocked by rules unless your UID matches the admin UID.";
      } else {
        statusEl.textContent = "";
      }
    });

    // ---------- HELPER: Cloudinary unsigned upload ----------
    async function uploadToCloudinary(file, progressCallback) {
      if (!file) throw new Error("No file provided");
      const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`;
      const fd = new FormData();
      fd.append('file', file);
      fd.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
      // send
      const res = await fetch(url, { method: 'POST', body: fd });
      if (!res.ok) {
        const txt = await res.text();
        throw new Error("Upload failed: " + txt);
      }
      const data = await res.json();
      return data; // contains secure_url, public_id, etc.
    }

    // -------------- SUPPORT WALL LISTENER --------------
    const supportListEl = document.getElementById('supportList');
    const supportQuery = query(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/supportMessages`), orderBy('timestamp','desc'));
    onSnapshot(supportQuery, snap => {
      supportListEl.innerHTML = '';
      snap.docs.forEach(docSnap => {
        const d = docSnap.data();
        const card = document.createElement('div');
        card.className = 'p-3 bg-white rounded shadow flex justify-between';
        card.innerHTML = `<div><strong>${d.name}</strong><div class="text-sm text-gray-600">${d.message}</div></div>
          <div class="text-xs text-gray-400">${d.timestamp?.toDate ? d.timestamp.toDate().toLocaleString() : ''}</div>`;
        supportListEl.appendChild(card);
      });
    }, err => { console.error(err); supportListEl.innerHTML = '<div class="text-red-600">Could not load support messages.</div>'; });

    // -------------- QUESTIONS LISTENER --------------
    const questionsListEl = document.getElementById('questionsList');
    const qQuery = query(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/questions`), orderBy('createdAt','desc'));
    onSnapshot(qQuery, snap => {
      questionsListEl.innerHTML = '';
      snap.docs.forEach(s => {
        const d = s.data();
        const el = document.createElement('div');
        el.className = 'p-3 bg-white rounded shadow';
        el.innerHTML = `<div class="font-semibold">${d.title || 'Question'}</div><div class="text-sm text-gray-700 mt-1">${d.body||''}</div>`;
        questionsListEl.appendChild(el);
      });
    }, err => { console.error(err); questionsListEl.innerHTML = '<div class="text-red-600">Could not load questions.</div>'; });

    // -------------- GALLERY UPLOAD + LISTENER --------------
    const galleryFile = document.getElementById('galleryFile');
    const galleryCaption = document.getElementById('galleryCaption');
    const galleryOrder = document.getElementById('galleryOrder');
    const uploadGalleryBtn = document.getElementById('uploadGalleryBtn');
    const galleryProgressFill = document.getElementById('galleryProgressFill');
    const galleryList = document.getElementById('galleryList');
    uploadGalleryBtn.addEventListener('click', async () => {
      try{
        uploadGalleryBtn.disabled = true;
        galleryProgressFill.style.width = '5%';
        const file = galleryFile.files[0];
        if (!file) throw new Error("Select an image file");
        const cloud = await uploadToCloudinary(file);
        galleryProgressFill.style.width = '70%';
        const docRef = await addDoc(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/gallery`), {
          imageUrl: cloud.secure_url,
          publicId: cloud.public_id,
          caption: galleryCaption.value || '',
          order: Number(galleryOrder.value || 1),
          createdAt: serverTimestamp()
        });
        galleryProgressFill.style.width = '100%';
        galleryFile.value = '';
        galleryCaption.value = '';
        galleryOrder.value = '1';
        setTimeout(()=> galleryProgressFill.style.width='0%', 600);
      } catch (e) {
        console.error(e);
        statusEl.textContent = 'Gallery upload failed: ' + e.message;
      } finally {
        uploadGalleryBtn.disabled = false;
      }
    });

    // listen gallery
    const galleryQuery = query(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/gallery`), orderBy('order','asc'), orderBy('createdAt','asc'));
    onSnapshot(galleryQuery, snap => {
      galleryList.innerHTML = '';
      snap.docs.forEach(docSnap => {
        const d = docSnap.data();
        const el = document.createElement('div');
        el.className = 'bg-white p-3 rounded shadow';
        el.innerHTML = `
          <img src="${d.imageUrl}" class="w-full h-48 object-cover rounded mb-2">
          <div class="text-sm text-gray-700">${d.caption || ''}</div>
          <div class="mt-2 flex gap-2">
            <button data-id="${docSnap.id}" class="deleteGalleryBtn bg-gray-100 px-3 py-1 rounded">Delete</button>
          </div>
        `;
        galleryList.appendChild(el);
      });
      // attach delete listeners
      document.querySelectorAll('.deleteGalleryBtn').forEach(b=>{
        b.addEventListener('click', async (e)=>{
          const id = e.target.getAttribute('data-id');
          try { await deleteDoc(doc(db, `/artifacts/${ARTIFACT_ID}/public/data/gallery/${id}`)); }
          catch(err){ console.error(err); alert('Delete failed: ' + err.message); }
        });
      });
    }, err => { console.error(err); galleryList.innerHTML = '<div class="text-red-600">Could not load gallery.</div>'; });

    // -------------- WINNERS --------------
    const winnerFile = document.getElementById('winnerFile');
    const saveWinnerBtn = document.getElementById('saveWinner');
    const winnersList = document.getElementById('winnersList');

    saveWinnerBtn.addEventListener('click', async () => {
      try{
        saveWinnerBtn.disabled = true;
        const name = document.getElementById('winnerName').value.trim();
        const handle = document.getElementById('winnerHandle').value.trim();
        const prize = document.getElementById('winnerPrize').value.trim();
        const announcedAt = document.getElementById('winnerAnnouncedAt').value ? new Date(document.getElementById('winnerAnnouncedAt').value) : null;
        const file = winnerFile.files[0];

        let imageUrl = '';
        if (file) {
          const cloud = await uploadToCloudinary(file);
          imageUrl = cloud.secure_url;
        }

        await addDoc(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/winners`), {
          name, handle, prize, imageUrl, announcedAt: announcedAt ? announcedAt.toISOString() : null,
          createdAt: serverTimestamp()
        });

        document.getElementById('winnerName').value=''; document.getElementById('winnerHandle').value=''; document.getElementById('winnerPrize').value=''; winnerFile.value='';
      } catch(e){
        console.error(e);
        alert('Save failed: ' + e.message);
      } finally { saveWinnerBtn.disabled = false; }
    });

    // winners list
    const winnersQuery = query(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/winners`), orderBy('createdAt','desc'));
    onSnapshot(winnersQuery, snap => {
      winnersList.innerHTML = '';
      snap.docs.forEach(dSnap=>{
        const d = dSnap.data();
        const el = document.createElement('div');
        el.className = 'p-3 bg-white rounded shadow flex gap-4 items-center';
        el.innerHTML = `
          <img src="${d.imageUrl||'https://via.placeholder.com/150'}" class="w-20 h-20 object-cover rounded">
          <div class="flex-1">
            <div class="font-semibold">${d.name} <span class="text-sm text-gray-500">(${d.handle||''})</span></div>
            <div class="text-sm text-gray-600">${d.prize||''}</div>
            <div class="text-xs text-gray-400 mt-1">${d.announcedAt ? new Date(d.announcedAt).toLocaleDateString() : ''}</div>
          </div>
          <div>
            <button data-id="${dSnap.id}" class="deleteWinnerBtn bg-gray-100 px-3 py-1 rounded">Delete</button>
          </div>
        `;
        winnersList.appendChild(el);
      });
      document.querySelectorAll('.deleteWinnerBtn').forEach(b=>{
        b.addEventListener('click', async e=>{
          const id = e.target.getAttribute('data-id');
          try { await deleteDoc(doc(db, `/artifacts/${ARTIFACT_ID}/public/data/winners/${id}`)); }
          catch(err){ console.error(err); alert('Delete failed: ' + err.message); }
        });
      });
    }, err => { console.error(err); winnersList.innerHTML = '<div class="text-red-600">Could not load winners.</div>'; });

    // -------------- GIVEAWAYS --------------
    const saveGiveawayBtn = document.getElementById('saveGiveaway');
    const giveawaysList = document.getElementById('giveawaysList');
    saveGiveawayBtn.addEventListener('click', async () => {
      try {
        saveGiveawayBtn.disabled = true;
        const title = document.getElementById('giveTitle').value.trim();
        const prize = document.getElementById('givePrize').value.trim();
        const endsAt = document.getElementById('giveEnds').value ? new Date(document.getElementById('giveEnds').value).toISOString() : null;
        if (!title) throw new Error("Title required");
        await addDoc(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/giveaways`), {
          title, prize, endsAt, status: 'active', createdAt: serverTimestamp()
        });
        document.getElementById('giveTitle').value=''; document.getElementById('givePrize').value=''; document.getElementById('giveEnds').value='';
      } catch(e) { console.error(e); alert('Save giveaway failed: ' + e.message); }
      finally { saveGiveawayBtn.disabled = false; }
    });

    // listen giveaways
    const giveQuery = query(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/giveaways`), orderBy('createdAt','desc'));
    onSnapshot(giveQuery, snap => {
      giveawaysList.innerHTML = '';
      snap.docs.forEach(snapDoc => {
        const d = snapDoc.data();
        const el = document.createElement('div');
        el.className = 'p-3 bg-white rounded shadow flex justify-between';
        el.innerHTML = `<div><strong>${d.title}</strong><div class="text-sm text-gray-600">${d.prize || ''}</div></div>
          <div class="flex gap-2">
            <button data-id="${snapDoc.id}" class="endGive bg-gray-100 px-3 py-1 rounded">End</button>
            <button data-id="${snapDoc.id}" class="delGive bg-gray-100 px-3 py-1 rounded">Delete</button>
          </div>`;
        giveawaysList.appendChild(el);
      });
      document.querySelectorAll('.endGive').forEach(b=> b.addEventListener('click', async e=>{
        const id = e.target.getAttribute('data-id');
        try { await updateDoc(doc(db, `/artifacts/${ARTIFACT_ID}/public/data/giveaways/${id}`), { status: 'ended' }); }
        catch(err){ console.error(err); alert('End failed: ' + err.message); }
      }));
      document.querySelectorAll('.delGive').forEach(b=> b.addEventListener('click', async e=>{
        const id = e.target.getAttribute('data-id');
        try { await deleteDoc(doc(db, `/artifacts/${ARTIFACT_ID}/public/data/giveaways/${id}`)); }
        catch(err){ console.error(err); alert('Delete failed: ' + err.message); }
      }));
    }, err => { console.error(err); giveawaysList.innerHTML = '<div class="text-red-600">Could not load giveaways.</div>'; });

    // -------------- FIXTURES (upload logos + save + list) --------------
    let homeLogoUrl = '', awayLogoUrl = '';

    document.getElementById('uploadHomeLogoBtn').addEventListener('click', async ()=>{
      try {
        const f = document.getElementById('homeLogoFile').files[0];
        if (!f) return alert('Choose a file first');
        const cloud = await uploadToCloudinary(f);
        homeLogoUrl = cloud.secure_url;
        document.getElementById('homeLogoPreview').textContent = 'Uploaded ✓';
      } catch(e){ console.error(e); alert('Home logo upload failed: ' + e.message); }
    });

    document.getElementById('uploadAwayLogoBtn').addEventListener('click', async ()=>{
      try {
        const f = document.getElementById('awayLogoFile').files[0];
        if (!f) return alert('Choose a file first');
        const cloud = await uploadToCloudinary(f);
        awayLogoUrl = cloud.secure_url;
        document.getElementById('awayLogoPreview').textContent = 'Uploaded ✓';
      } catch(e){ console.error(e); alert('Away logo upload failed: ' + e.message); }
    });

    document.getElementById('saveFixture').addEventListener('click', async ()=>{
      try {
        const home = document.getElementById('fixtureHome').value.trim();
        const away = document.getElementById('fixtureAway').value.trim();
        const dt = document.getElementById('fixtureDate').value;
        const stadium = document.getElementById('fixtureStadium').value.trim();
        const level = document.getElementById('fixtureLevel').value;
        const status = document.getElementById('fixtureStatus').value;
        if (!home || !away || !dt) throw new Error("Home, away & date required");
        await addDoc(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/fixtures`), {
          home, away, datetime: dt, stadium, level, status, homeLogoUrl: homeLogoUrl||'', awayLogoUrl: awayLogoUrl||'', createdAt: serverTimestamp()
        });
        // reset local
        document.getElementById('fixtureForm').reset();
        homeLogoUrl = awayLogoUrl = '';
        document.getElementById('homeLogoPreview').textContent = '';
        document.getElementById('awayLogoPreview').textContent = '';
      } catch(e){ console.error(e); alert('Save fixture failed: ' + e.message); }
    });

    // fixtures list
    const fixturesListEl = document.getElementById('fixturesList');
    const fixturesQuery = query(collection(db, `/artifacts/${ARTIFACT_ID}/public/data/fixtures`), orderBy('datetime','asc'));
    onSnapshot(fixturesQuery, snap => {
      fixturesListEl.innerHTML = '';
      snap.docs.forEach(snapDoc => {
        const d = snapDoc.data();
        const card = document.createElement('div');
        card.className = 'p-4 bg-white rounded shadow flex gap-4 items-center';
        card.innerHTML = `
          <div class="w-20">
            <img src="${d.homeLogoUrl||'https://via.placeholder.com/60'}" class="w-10 h-10 object-cover inline-block rounded mr-2">
            <img src="${d.awayLogoUrl||'https://via.placeholder.com/60'}" class="w-10 h-10 object-cover inline-block rounded">
          </div>
          <div class="flex-1">
            <div class="font-semibold">${d.home} vs ${d.away}</div>
            <div class="text-sm text-gray-600">${d.datetime} • ${d.stadium || ''}</div>
          </div>
          <div>
            <button data-id="${snapDoc.id}" class="deleteFixtureBtn bg-gray-100 px-3 py-1 rounded">Delete</button>
          </div>
        `;
        fixturesListEl.appendChild(card);
      });
      document.querySelectorAll('.deleteFixtureBtn').forEach(b=>{
        b.addEventListener('click', async e=>{
          const id = e.target.getAttribute('data-id');
          try { await deleteDoc(doc(db, `/artifacts/${ARTIFACT_ID}/public/data/fixtures/${id}`)); }
          catch(err) { console.error(err); alert('Delete failed: ' + err.message); }
        });
      });
    }, err => { console.error(err); fixturesListEl.innerHTML = '<div class="text-red-600">Could not load fixtures.</div>'; });

    // initial tab
    switchTo('gallery');

  </script>
</body>
</html>
