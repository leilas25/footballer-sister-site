<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin – The Footballer’s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" href="data:,">
  <style>
    .fade-in { animation: fade .25s ease-out; }
    @keyframes fade { from {opacity:0; transform:translateY(4px)} to {opacity:1; transform:none} }
    .logo-preview { width: 32px; height: 32px; border-radius: 9999px; object-fit: cover; background: #f3f4f6; }
  </style>
</head>

<body class="bg-pink-50 text-black font-sans min-h-screen flex flex-col">
  <!-- Header -->
  <header class="fixed top-0 w-full flex justify-between items-center px-6 py-4 bg-pink-100 shadow z-50">
    <h1 class="text-xl font-bold uppercase text-rose-600">Admin • The Footballer’s Sister</h1>
    <nav class="space-x-6">
      <a href="index.html" class="hover:underline text-rose-600">Home</a>
    </nav>
  </header>

  <!-- LOGIN -->
  <main id="loginSection" class="flex-grow pt-32 px-6 pb-20">
    <div class="max-w-sm mx-auto bg-white rounded-xl shadow p-6 fade-in">
      <h2 class="text-2xl font-bold text-rose-700 mb-2">Admin Login</h2>
      <p class="text-sm text-gray-600 mb-4">Sign in with your admin email & password.</p>
      <form id="loginForm" class="space-y-3">
        <input id="email" type="email" required placeholder="Email"
               class="w-full px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-rose-500"/>
        <input id="password" type="password" required placeholder="Password"
               class="w-full px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-rose-500"/>
        <button class="w-full bg-rose-600 text-white px-6 py-3 rounded-full hover:bg-rose-700 font-semibold">
          Log in
        </button>
      </form>
      <p id="loginError" class="text-red-600 text-sm mt-3 hidden"></p>
    </div>
  </main>

  <!-- NO ACCESS -->
  <section id="noAccess" class="hidden flex-grow pt-32 px-6 pb-20 text-center">
    <h2 class="text-2xl font-bold text-rose-700 mb-2">No Access</h2>
    <p class="text-gray-700">This account is not authorized to use the admin panel.</p>
    <button id="logoutNoAccess" class="mt-6 bg-gray-200 text-gray-900 px-4 py-2 rounded-full hover:bg-gray-300">
      Log out
    </button>
  </section>

  <!-- ADMIN DASHBOARD -->
  <section id="adminPanel" class="hidden flex-grow pt-32 px-6 pb-20 max-w-5xl mx-auto fade-in">
    <div class="flex items-center justify-between mb-6">
      <div class="flex flex-wrap gap-3">
        <button data-tab="support"  class="tab-btn bg-rose-600 text-white px-4 py-2 rounded-full">Support Wall</button>
        <button data-tab="qa"       class="tab-btn bg-gray-200 text-gray-900 px-4 py-2 rounded-full">Q&A</button>
        <button data-tab="fixtures" class="tab-btn bg-gray-200 text-gray-900 px-4 py-2 rounded-full">Fixtures</button>
      </div>
      <button id="logoutBtn" class="bg-rose-600 text-white px-4 py-2 rounded-full hover:bg-rose-700">Log out</button>
    </div>

    <!-- Support Wall -->
    <div id="tab-support">
      <h2 class="text-2xl font-bold text-rose-700 mb-3">Support Wall – Moderate</h2>
      <div id="supportList" class="space-y-3"><p class="text-gray-500">Loading…</p></div>
    </div>

    <!-- Q&A -->
    <div id="tab-qa" class="hidden">
      <h2 class="text-2xl font-bold text-rose-700 mb-3">Q&A – Answer & Moderate</h2>
      <p id="qaCounts" class="text-xs text-gray-500 mb-2">Totals: —</p>
      <div id="qaList" class="space-y-3"><p class="text-gray-500">Loading…</p></div>
    </div>

    <!-- FIXTURES -->
    <div id="tab-fixtures" class="hidden">
      <h2 class="text-2xl font-bold text-rose-700 mb-4">Fixtures – Add / Update</h2>
      <form id="fxForm" class="grid md:grid-cols-2 gap-3 bg-white p-4 rounded-xl border shadow mb-6">
        <input type="hidden" id="fxId" />
        <div>
          <label class="text-sm">Team Level</label>
          <select id="fxLevel" class="w-full border rounded px-3 py-2">
            <option>U14</option>
            <option>U19</option>
          </select>
        </div>
        <div>
          <label class="text-sm">Opponent</label>
          <input id="fxOpponent" class="w-full border rounded px-3 py-2" placeholder="e.g. Kaizer Chiefs U14"/>
        </div>
        <div>
          <label class="text-sm">Home/Away</label>
          <select id="fxHa" class="w-full border rounded px-3 py-2">
            <option value="home">Home</option>
            <option value="away">Away</option>
          </select>
        </div>
        <div>
          <label class="text-sm">Venue</label>
          <input id="fxVenue" class="w-full border rounded px-3 py-2" placeholder="e.g. Rand Stadium"/>
        </div>
        <div>
          <label class="text-sm">Date & Time</label>
          <input id="fxDateTime" type="datetime-local" class="w-full border rounded px-3 py-2"/>
        </div>
        <div>
          <label class="text-sm">Competition</label>
          <input id="fxComp" class="w-full border rounded px-3 py-2" placeholder="e.g. GDL League"/>
        </div>

        <div>
          <label class="text-sm">Jomo Cosmos Logo</label>
          <input id="fxHomeLogoFile" type="file" accept="image/*" class="w-full border rounded px-3 py-2 bg-white"/>
        </div>
        <div>
          <label class="text-sm">Opponent Logo</label>
          <input id="fxAwayLogoFile" type="file" accept="image/*" class="w-full border rounded px-3 py-2 bg-white"/>
        </div>

        <div class="md:col-span-2">
          <label class="text-sm">Stream URL</label>
          <input id="fxStream" class="w-full border rounded px-3 py-2" placeholder="https://…"/>
        </div>

        <div class="flex gap-2 md:col-span-2">
          <button id="fxSave" type="submit" class="bg-rose-600 text-white px-4 py-2 rounded hover:bg-rose-700">Save</button>
          <button type="button" id="fxReset" class="bg-gray-200 text-gray-900 px-4 py-2 rounded">Reset</button>
        </div>
        <p id="fxMsg" class="md:col-span-2 text-xs text-gray-600"></p>
      </form>
      <div id="fxList" class="space-y-3"></div>
    </div>
  </section>

  <footer class="bg-pink-900 text-white text-center py-6">
    <p>&copy; <span id="year"></span> The Footballer’s Sister. All rights reserved.</p>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- FIREBASE ADMIN -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import {
      getFirestore, collection, onSnapshot, doc, deleteDoc, updateDoc, addDoc,
      serverTimestamp, Timestamp, getDoc
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import {
      getStorage, ref as storageRef, uploadBytesResumable, getDownloadURL
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

    const ADMIN_UID = "pDokgebzpTZWzmn9dW50kaDAqRT2";

    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };

    const APP_ID = "1:65396604482:web:0f31625a714aa8352337db";
    const QUESTIONS_PATH = `artifacts/${APP_ID}/public/data/questions`;
    const SUPPORT_PATH   = `artifacts/${APP_ID}/public/data/supportMessages`;
    const FIXTURES_PATH  = `artifacts/${APP_ID}/public/data/fixtures`;

    const JC_LOGO_U14_DEFAULT = "/images/jc-u14.png";
    const JC_LOGO_U19_DEFAULT = "/images/jc-u19.png";
    const OPP_FALLBACK = "/images/opponent.png";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const storage = getStorage(app);

    const fxForm = document.getElementById('fxForm');
    const fxMsg  = document.getElementById('fxMsg');
    const fxHomeLogoFile = document.getElementById('fxHomeLogoFile');
    const fxAwayLogoFile = document.getElementById('fxAwayLogoFile');

    // --- Upload function with detailed feedback ---
    async function uploadLogoFile(file, pathBase) {
      const ext = (file.name.split('.').pop() || 'png').toLowerCase();
      const sref = storageRef(storage, `${pathBase}.${ext}`);
      return await new Promise((resolve, reject) => {
        const task = uploadBytesResumable(sref, file, { contentType: file.type || "image/*" });
        task.on('state_changed',
          snap => {
            const pct = Math.round((snap.bytesTransferred / snap.totalBytes) * 100);
            fxMsg.textContent = `Uploading logo… ${pct}%`;
          },
          err => {
            console.error('[Storage upload error]', err);
            fxMsg.textContent = `Upload failed: ${err.code || err.message}`;
            reject(err);
          },
          async () => {
            try {
              const url = await getDownloadURL(task.snapshot.ref);
              console.log('[Upload complete]', url);
              fxMsg.textContent = 'Upload complete.';
              resolve(url);
            } catch (e) {
              console.error('[getDownloadURL error]', e);
              fxMsg.textContent = `Upload finished but URL failed: ${e.message}`;
              reject(e);
            }
          }
        );
      });
    }

    /* rest of your admin logic remains unchanged — saving fixtures, rendering, etc. */
  </script>
</body>
</html>
