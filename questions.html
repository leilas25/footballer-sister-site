<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Q&A â€“ The Footballerâ€™s Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tweet-card {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 16px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }
    .tweet-avatar {
      width: 48px;
      height: 48px;
      border-radius: 9999px;
      background-color: #fce7f3;
      flex-shrink: 0;
    }
    .tweet-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .tweet-name {
      font-weight: bold;
      color: #1a202c;
    }
    .tweet-handle {
      font-size: 0.875rem;
      color: #a0aec0;
    }
    .tweet-timestamp {
      font-size: 0.75rem;
      color: #718096;
    }
    .delete-button {
      margin-left: auto;
      align-self: center;
      color: #e53e3e;
      border-radius: 9999px;
      padding: 0.25rem;
      transition: color 0.2s ease, background-color 0.2s ease;
    }
    .delete-button:hover {
      color: #c53030;
      background-color: #fff5f5;
    }
    .answer-box {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background: #fce7f3;
      border-radius: 8px;
      display: flex;
      gap: 0.5rem;
      align-items: flex-start;
    }
    .answer-textarea {
      flex-grow: 1;
      border-radius: 6px;
      border: 1px solid #ccc;
      padding: 0.4rem 0.6rem;
    }
    .answer-btn {
      background: #be185d;
      color: #fff;
      border-radius: 6px;
      padding: 0.4rem 1.2rem;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .answer-btn:hover {
      background: #a31545;
    }
  </style>
</head>
<body class="bg-pink-50 text-black font-sans min-h-screen flex flex-col">

  <!-- Header -->
  <header class="fixed top-0 w-full flex justify-between items-center px-6 py-4 bg-pink-100 shadow z-50">
    <h1 class="text-xl font-bold uppercase text-rose-600">The Footballerâ€™s Sister</h1>
    <nav class="space-x-6">
      <a href="index.html" class="hover:underline text-rose-600">Home</a>
      <a href="bts.html" class="hover:underline text-rose-600">Behind the Game</a>
      <a href="leila.html" class="hover:underline text-rose-600">Meet Leila</a>
      <a href="questions.html" class="font-semibold underline text-rose-600">Q&amp;A</a>
      <a href="support-wall.html" class="hover:underline text-rose-600">Support Wall</a>
    </nav>
  </header>

  <main class="flex-grow pt-32 px-6 pb-20 text-center max-w-2xl mx-auto">
    <h2 class="text-4xl font-bold mb-4 text-rose-700">Ask Me Anything Q&amp;A</h2>
    <p class="text-sm text-gray-600 mb-6">
      Here are your questions and my answers!<br>
      <span id="user-id" class="font-mono text-xs text-pink-700 break-all"></span>
    </p>
    <div id="qa-container" class="mt-8 space-y-4 max-h-[600px] overflow-y-auto text-left">
      <p id="loading-indicator" class="text-gray-500 text-center">Loading questions...</p>
    </div>
  </main>
  
  <footer class="bg-pink-900 text-white text-center py-6">
    <p>&copy; 2025 The Footballerâ€™s Sister. All rights reserved.</p>
  </footer>

  <!-- Firebase SDK and Q&A Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      onSnapshot,
      deleteDoc,
      doc,
      updateDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const appId = '1:65396604482:web:0f31625a714aa8352337db';
    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const ADMIN_USER_ID = 'QI9BHJqqqibPKlQFNSlDRCgvZ5t2'; // your admin UID

    // Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    window.getAuth = () => auth;

    let userId = null;
    const userIdEl = document.getElementById('user-id');
    const qaContainer = document.getElementById('qa-container');
    const loadingIndicator = document.getElementById('loading-indicator');

    function escapeHtml(text) {
      if (!text) return '';
      return text.replace(/[&<>"']/g, function(m) {
        return ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#039;'
        })[m];
      });
    }

    // Listen for auth and load questions
    onAuthStateChanged(auth, async (user) => {
      if (!user) await signInAnonymously(auth);
      userId = auth.currentUser?.uid || null;
      userIdEl.textContent = userId ? `Your user ID is ${userId}` : "";

      onSnapshot(
        collection(db, `/artifacts/${appId}/public/data/questions`),
        (snapshot) => {
          qaContainer.innerHTML = '';
          loadingIndicator.style.display = 'none';
          const questions = [];
          snapshot.forEach(docSnap => {
            questions.push({ id: docSnap.id, ...docSnap.data() });
          });
          // Sort newest first
          questions.sort((a, b) => {
            const tA = a.timestamp?.seconds ?? 0;
            const tB = b.timestamp?.seconds ?? 0;
            return tB - tA;
          });
          if (questions.length === 0) {
            qaContainer.innerHTML = '<p class="text-gray-600 text-center">No questions yet. Ask Leila anything!</p>';
          }
          questions.forEach(q => {
            const card = document.createElement('div');
            card.className = 'tweet-card';
            card.innerHTML = `
              <svg class="tweet-avatar" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#be185d">
                <circle cx="12" cy="12" r="10" fill="#fce7f3"/>
                <text x="12" y="17" text-anchor="middle" font-size="13" fill="#be185d" font-family="Arial" font-weight="bold">Q</text>
              </svg>
              <div class="flex-grow">
                <div class="tweet-header">
                  <p class="tweet-name">${escapeHtml(q.name || 'Anonymous')}</p>
                  <p class="tweet-handle">@user_${(q.userId || '').substring(0, 8)}</p>
                  <p class="tweet-timestamp">Â· ${
                    q.timestamp?.seconds
                      ? new Date(q.timestamp.seconds * 1000).toLocaleDateString()
                      : 'Just now'
                  }</p>
                </div>
                <p class="tweet-content break-words mb-2">${escapeHtml(q.question)}</p>
                ${
                  q.answer
                    ? `<div class="mt-2 bg-rose-50 rounded-lg p-3 text-left">
                        <strong class="text-rose-700">Leilaâ€™s Answer:</strong><br>
                        <span>${escapeHtml(q.answer)}</span>
                        <div class="text-xs text-gray-500 mt-1">${q.answeredAt?.seconds ? "Answered: " + new Date(q.answeredAt.seconds * 1000).toLocaleDateString() : ""}</div>
                      </div>`
                    : userId === ADMIN_USER_ID
                      ? `<form class="answer-box" data-id="${q.id}">
                          <textarea class="answer-textarea" placeholder="Type your answer..." required></textarea>
                          <button type="submit" class="answer-btn">Post Answer</button>
                        </form>`
                      : `<div class="mt-2 text-gray-500 italic text-sm">Leila will answer soon!</div>`
                }
              </div>
            `;
            // Admin can delete any question
            if (userId === ADMIN_USER_ID) {
              const deleteBtn = document.createElement('button');
              deleteBtn.className = 'delete-button';
              deleteBtn.innerHTML = `ðŸ—‘ï¸`;
              deleteBtn.title = 'Delete Question';
              deleteBtn.onclick = async () => {
                try {
                  await deleteDoc(doc(db, `/artifacts/${appId}/public/data/questions`, q.id));
                } catch {
                  alert('Failed to delete question.');
                }
              };
              card.appendChild(deleteBtn);
            }
            qaContainer.appendChild(card);

            // Attach answer handler if admin and not answered yet
            if (userId === ADMIN_USER_ID && !q.answer) {
              card.querySelector('form').onsubmit = async (e) => {
                e.preventDefault();
                const textarea = e.target.querySelector('.answer-textarea');
                const answer = textarea.value.trim();
                if (!answer) return;
                try {
                  await updateDoc(doc(db, `/artifacts/${appId}/public/data/questions`, q.id), {
                    answer,
                    answeredBy: userId,
                    answeredAt: serverTimestamp()
                  });
                } catch {
                  alert('Failed to post answer. Try again.');
                }
              };
            }
          });
        }
      );
    });
  </script>

</body>
</html>