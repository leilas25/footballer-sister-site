<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Giveaways ‚Äî The Footballer‚Äôs Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .ig-card { background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);overflow:hidden;transition:transform .18s,box-shadow .18s;cursor:pointer; }
    .ig-card:hover { transform:translateY(-6px); box-shadow:0 18px 36px rgba(0,0,0,0.12); }
    .ig-header{display:flex;align-items:center;gap:.75rem;padding:.75rem;}
    .ig-avatar{width:40px;height:40px;border-radius:9999px;object-fit:cover;}
    .ig-image{width:100%;height:420px;object-fit:cover;display:block;}
    .pill-bar{display:flex;gap:8px;justify-content:center;margin-bottom:1rem;flex-wrap:wrap;}
    .pill{padding:.5rem 1rem;border-radius:999px;font-weight:700;background:#fff;border:1px solid #fde7ef;color:#be185d;cursor:pointer;}
    .pill.active{background:linear-gradient(90deg,#be185d,#f472b6);color:white;border:none;}
    .give-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;}
    @media (max-width:900px){ .give-grid{grid-template-columns:1fr;} .ig-image{height:260px;} }
    :root{--accent:#be185d;--muted:#6b7280;}
    header.bts-header{background:linear-gradient(180deg, rgba(246,213,239,0.6), rgba(255,241,248,0.6));border-bottom:1px solid rgba(235,200,215,0.6);backdrop-filter:blur(4px);}
    .site-title{color:var(--accent);font-weight:800;letter-spacing:.02em;}
    footer .footer-badge{display:inline-block;background:linear-gradient(90deg,#be185d,#f472b6);color:white;padding:.45rem .85rem;border-radius:999px;font-weight:700;}
    .dropdown-open{opacity:1!important;transform:scale(1)!important;}
    .status-badge{position:absolute;top:12px;right:12px;z-index:12;padding:.28rem .6rem;border-radius:999px;background:#fff;border:1px solid #fde7ef;color:#be185d;font-weight:700;font-size:.8rem;box-shadow:0 6px 18px rgba(0,0,0,0.04);}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:none;align-items:center;justify-content:center;z-index:90;}
    .modal{background:#fff;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.25);padding:18px;max-height:90vh;overflow-y:auto;width:920px;max-width:calc(100% - 32px);}
    @media (max-width:640px){ .modal{width:96%;padding:12px;} }
    .modal-hero{display:flex;gap:12px;align-items:center;margin-bottom:12px;}
    .modal-hero .icon{width:72px;height:72px;border-radius:9999px;background:#fff0f6;border:1px solid #FBCFE8;background-image:url('images/football-sis-logo.png');background-size:cover;background-position:center;box-shadow:0 6px 18px rgba(0,0,0,0.06);flex-shrink:0;}
    .modal-title{color:var(--accent);font-weight:800;font-size:1.25rem;}
    .modal-meta{color:var(--muted);font-size:.95rem;}
    .modal-image{width:100%;height:320px;object-fit:cover;border-radius:10px;margin-bottom:12px;}
    .modal-actions{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap;}
    .btn-rose{background:linear-gradient(90deg,#be185d,#f472b6);Color:white;padding:.6rem .9rem;border-radius:999px;font-weight:800;text-decoration:none;}
    .btn-outline{background:transparent;border:1px solid #FBCFE8;color:var(--accent);padding:.5rem .8rem;border-radius:999px;font-weight:700;cursor:pointer;}
    .share-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-left:auto;}
    .countdown{display:inline-block;padding:.3rem .6rem;border-radius:8px;background:#fff0f6;border:1px solid #fbddec;color:#9b1140;font-weight:800;font-size:.95rem;}
    ul.rules { text-align:left; margin-top:8px; }
    ul.rules li { margin-bottom:6px; }

    /* small form inside modal */
    .entry-row { display:flex; gap:8px; align-items:center; margin-top:12px; flex-wrap:wrap; }
    .entry-row input[type="text"]{ padding:.55rem .7rem; border-radius:8px; border:1px solid #E6E6E6; min-width:220px; }
    .checkbox-inline { display:inline-flex; gap:8px; align-items:center; }
    .muted { color: #6b7280; }

    /* winners cards (reuse winner-card classes used elsewhere) */
    .winner-card {
      background:#fff;
      border:1px solid #f3d3e2;
      border-radius:12px;
      overflow:hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
      text-align:left;
      display:flex;
      flex-direction:column;
      transition: transform .14s ease, box-shadow .14s ease;
    }
    .winner-card:hover { transform: translateY(-6px); box-shadow: 0 18px 36px rgba(0,0,0,0.08); }
    .winner-thumb { width:100%; height:220px; object-fit:cover; display:block; }
    .winner-body { padding:14px; }
    .winner-name { font-weight:800; color:var(--accent); font-size:1.05rem; margin-bottom:6px; }
    .winner-handle { color:#6b7280; font-size:.95rem; margin-bottom:8px; }
    .winner-prize { color:#374151; font-weight:600; padding:.25rem .5rem; border-radius:8px; display:inline-block; font-size:.95rem; }

    .empty { color:#6b7280; margin-top:1.25rem; text-align:center; }
  </style>
</head>
<body class="bg-pink-50">

  <!-- header (same as other pages) -->
  <header class="bts-header fixed top-0 w-full z-50">
    <div class="flex justify-between items-center px-6 py-4 container" style="max-width:1100px;margin:0 auto;">
      <div style="display:flex;align-items:center;gap:1rem;"><div class="site-title" style="font-size:1.15rem;">THE FOOTBALLER‚ÄôS SISTER</div></div>
      <div class="relative inline-block text-left">
        <button id="navButton" class="inline-flex justify-center rounded-md border border-pink-200 shadow-sm px-4 py-2 bg-white text-sm font-medium text-rose-600 hover:bg-pink-50 focus:outline-none" aria-expanded="false">
          <span id="navTitle">Loading...</span>
          <svg class="-mr-1 ml-2 h-5 w-5 text-rose-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/>
          </svg>
        </button>

        <div id="dropdownMenu" class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 transform transition-all duration-200 ease-out scale-95 opacity-0">
          <div class="py-1">
            <a href="index.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Home</a>
            <a href="bts.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Behind the Game</a>
            <a href="leila.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Meet Leila</a>
            <a href="questions.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Q&A</a>
            <a href="support-wall.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Support Wall</a>
            <a href="fixtures.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Fixtures & Live Scores</a>
            <a href="giveaways.html" class="nav-item block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50">Giveaways</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="h-24"></div>

  <main class="pt-6 max-w-6xl mx-auto px-6 text-center">
    <h2 class="text-4xl font-bold text-rose-700 mb-2">Win Exclusive Prizes üéÅ</h2>
    <p class="text-gray-600 mb-6">Enter current giveaways below. Winners are contacted via email / IG DM.</p>

    <div class="pill-bar" role="tablist" aria-label="Giveaway filters">
      <button id="pill-all" class="pill active" data-filter="all">All</button>
      <button id="pill-ongoing" class="pill" data-filter="ongoing">Ongoing giveaways</button>
      <button id="pill-past" class="pill" data-filter="past">Past giveaways</button>
      <button id="pill-winners" class="pill" data-filter="winner">Winners</button>
    </div>

    <section id="giveGridWrap" class="mb-12">
      <div id="giveGrid" class="give-grid"></div>
      <!-- Winners container will be injected here when the winners tab is loaded -->
      <section id="winnersSection" class="mt-8" aria-live="polite"></section>
    </section>

    <div id="giveEmpty" class="text-gray-500 mt-8 hidden">No giveaways in this category.</div>
  </main>

  <footer class="text-center py-6">
    <div class="container" style="max-width:1100px;margin:0 auto;"><small><span class="footer-badge">¬© <span id="year"></span> The Footballer‚Äôs Sister</span></small></div>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- modal container -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div id="modalContainer" class="modal" role="dialog" aria-modal="true" style="display:none;"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, addDoc, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const ARTIFACT_ID = "1:65396604482:web:0f31625a714aa8352337db";
    const GIVEAWAYS_COLLECTION_PATH = `/artifacts/${ARTIFACT_ID}/public/data/giveaways`;
    const ENTRIES_COLLECTION_PATH = `/artifacts/${ARTIFACT_ID}/public/data/giveawayEntries`;

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    // expose db so the console/tests can access it and other scripts can reuse it
    window.db = db;
    const auth = getAuth(app);

    // anonymous auth to allow writes
    (async function trySignInAnonymously(){
      try {
        onAuthStateChanged(auth, async (user) => {
          if (!user) {
            try { await signInAnonymously(auth); } catch(e){ console.warn('signInAnonymously failed', e); }
          }
        });
      } catch(e){ console.warn('Auth setup failed', e); }
    })();

    const giveGrid = document.getElementById('giveGrid');
    const giveEmpty = document.getElementById('giveEmpty');
    const pills = Array.from(document.querySelectorAll('.pill'));
    let currentFilter = 'all';
    let giveawaysCache = [];

    function escapeHtml(s){ if(!s && s !== 0) return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function niceDateLabel(ts){ if(!ts) return '‚Äî'; try{ if(ts.seconds) return new Date(ts.seconds*1000).toLocaleString(); return new Date(ts).toLocaleString(); }catch(e){return '‚Äî';} }

    // -------------------- Cloudinary transform helper --------------------
    function cloudinaryTransform(url, w = 800, h = 450) {
      if (!url || typeof url !== 'string') return url;
      if (!url.includes('res.cloudinary.com')) return url;
      return url.replace('/upload/', `/upload/w_${w},h_${h},c_fill,g_auto,q_auto,f_auto/`);
    }
    // -------------------------------------------------------------------

    function renderGrid(items){
      giveGrid.innerHTML = '';
      const visible = items.filter(it => currentFilter==='all' ? true : (it.status || 'ongoing') === currentFilter );
      if(!visible.length) giveEmpty.classList.remove('hidden'); else giveEmpty.classList.add('hidden');

      visible.forEach(item => {
        const endsAtLabel = niceDateLabel(item.endsAt);
        const status = escapeHtml(item.status || 'ongoing');
        const card = document.createElement('article');
        card.className = 'ig-card text-left relative';
        card.dataset.id = item.id;

        const titleHtml = `<div class="font-bold text-rose-700 text-lg">${escapeHtml(item.title || 'Giveaway')}</div>`;

        // Use cloudinaryTransform on item.imageUrl
        const imgSrc = cloudinaryTransform(item.imageUrl || '');

        card.innerHTML = `
          <div class="ig-header">
            <img src="images/football-sis-logo.png" class="ig-avatar" alt="Logo">
            <div style="flex:1;">
              <div class="font-semibold text-rose-700">The Footballer‚Äôs Sister</div>
              <div class="text-xs text-gray-500">${item.createdAt && item.createdAt.seconds ? new Date(item.createdAt.seconds*1000).toLocaleDateString() : ''}</div>
            </div>
            <div style="margin-left:12px;"><span class="status-badge">${status}</span></div>
          </div>

          <img src="${escapeHtml(imgSrc||'')}" alt="${escapeHtml(item.title||'Giveaway')}" class="ig-image" onerror="this.onerror=null;this.src='images/opponent.png'"/>

          <div class="p-4">
            ${titleHtml}
            <div class="text-gray-700 mt-2">${escapeHtml(item.caption||'')}</div>
            <div class="text-xs text-gray-400 mt-3">Ends: ${endsAtLabel}</div>
            <!-- button removed from cards by request (cards clickable to open modal) -->
          </div>
        `;

        // Open modal when card clicked. Ignore clicks on anchor tags inside.
        card.addEventListener('click', (ev) => { if(ev.target.tagName && ev.target.tagName.toLowerCase()==='a') return; openGiveawayModal(item.id); });
        giveGrid.appendChild(card);
      });
    }

    // modal logic
    const backdrop = document.getElementById('modalBackdrop');
    const modalContainer = document.getElementById('modalContainer');
    let countdownInterval = null;
    function clearCountdown(){ if(countdownInterval){ clearInterval(countdownInterval); countdownInterval = null; } }
    function formatRemaining(ms){ if(ms<=0) return 'Ended'; const s=Math.floor(ms/1000); const days=Math.floor(s/86400); const hours=Math.floor((s%86400)/3600); const mins=Math.floor((s%3600)/60); if(days>0) return `${days}d ${hours}h`; if(hours>0) return `${hours}h ${mins}m`; return `${mins}m`; }

    function openGiveawayModal(id, pushState = true){
      const item = giveawaysCache.find(x=>x.id===id); if(!item) return; clearCountdown();
      const endsAtLabel = niceDateLabel(item.endsAt);
      const countdownHtml = item.endsAt ? `<span id="modalCountdown" class="countdown">Loading...</span>` : '';
      // Rules
      const rulesHtml = `
        <ul class="rules">
          <li><strong>1)</strong> Follow @leila_sono_, @bamuza_sono & @elijah_sono on Instagram & TikTok.</li>
          <li><strong>2)</strong> Post the giveaway to your Instagram story.</li>
          <li><strong>3)</strong> Tag 3 friends in the comments on the giveaway post.</li>
          <li><strong>4)</strong> Send your name and screenshots proving the above to <strong>@the_footballers_sister</strong> on Instagram via DM & Follow.</li>
        </ul>
        <p style="margin-top:6px;color:#6b7280;">We will verify screenshots and your name before adding you to the draw. Winners are chosen at random.</p>
      `;

      // Use cloudinaryTransform for modal image too
      const modalImgSrc = cloudinaryTransform(item.imageUrl || '');

      modalContainer.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;">
          <div style="display:flex;gap:12px;align-items:center;">
            <div class="icon"></div>
            <div>
              <div class="modal-title">${escapeHtml(item.title||'Giveaway')}</div>
              <div class="modal-meta">Ends: ${endsAtLabel} ${countdownHtml ? ' ¬∑ ' + countdownHtml : ''}</div>
            </div>
          </div>
          <div style="display:flex;gap:8px;align-items:center;">
            <div class="share-row" id="shareRow"></div>
            <button id="modalCloseBtn" class="btn-outline">Close</button>
          </div>
        </div>

        <img src="${escapeHtml(modalImgSrc||'')}" class="modal-image" alt="${escapeHtml(item.title||'Giveaway')}" onerror="this.onerror=null;this.src='images/opponent.png'"/>

        <div style="display:flex;gap:18px;flex-direction:column;">
          <div class="text-gray-800" style="line-height:1.6;">${escapeHtml(item.caption||'')}</div>

          <div style="margin-top:8px;">
            <h4 style="color:var(--accent);font-weight:800;margin-bottom:6px;">How to enter</h4>
            ${rulesHtml}
          </div>

          <!-- verification checkbox + name entry -->
          <div class="entry-row">
            <label class="checkbox-inline"><input id="confirmCheckbox" type="checkbox"/> <span class="muted">I confirm I've done the 4 steps above</span></label>
            <input id="entryName" type="text" placeholder="Your full name (as you'll DM)" aria-label="Your name"/>
            <button id="submitEntryBtn" class="btn-rose">Submit Name</button>
            <div id="entryStatus" class="muted" style="margin-left:8px;font-size:.95rem;"></div>
          </div>

          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px;">
            <a id="enterBtn" href="${escapeHtml(item.link||'#')}" target="${item.link?'_blank':'_self'}" class="btn-outline">${item.link? 'Open external link' : 'No external link'}</a>
            <button id="copyLinkBtn" class="btn-outline">Copy Link</button>
            <button id="whatsappBtn" class="btn-outline">Share on WhatsApp</button>
            <button id="nativeShareBtn" class="btn-outline">Share</button>
          </div>

          <div style="margin-top:8px;" class="text-xs text-gray-500"><strong>Note:</strong> We will manually verify the screenshots you send to <strong>@lifeofafootballsis</strong> before adding your name to the draw.</div>
        </div>
      `;

      backdrop.style.display = 'flex'; modalContainer.style.display = 'block'; backdrop.setAttribute('aria-hidden','false');
      const shareUrl = `${location.origin}${location.pathname}?id=${encodeURIComponent(id)}`;

      // countdown
      if(item.endsAt){
        const target = item.endsAt.seconds ? (item.endsAt.seconds*1000) : new Date(item.endsAt).getTime();
        const countdownEl = document.getElementById('modalCountdown');
        function tick(){ const rem = target - Date.now(); if(rem<=0){ countdownEl.textContent='Ended'; clearCountdown(); } else countdownEl.textContent = formatRemaining(rem); }
        tick(); countdownInterval = setInterval(tick, 1000*30);
      }

      // share/copy buttons
      document.getElementById('copyLinkBtn').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(shareUrl); const b=document.getElementById('copyLinkBtn'); b.textContent='Link copied'; setTimeout(()=>b.textContent='Copy Link',2000);}catch(e){} });
      document.getElementById('whatsappBtn').addEventListener('click', ()=>{ const text = encodeURIComponent(`${item.title||'Giveaway'} ‚Äî Enter here: ${shareUrl}`); window.open(`https://wa.me/?text=${text}`,'_blank','noopener'); });
      document.getElementById('nativeShareBtn').addEventListener('click', async ()=>{ if(navigator.share){ try{ await navigator.share({ title:item.title||'Giveaway', text:item.caption||'', url:shareUrl }); }catch(e){} } else { try{ await navigator.clipboard.writeText(shareUrl); const b=document.getElementById('nativeShareBtn'); b.textContent='Link copied'; setTimeout(()=>b.textContent='Share',2000);}catch(e){} } });

      // entry submit handler
      document.getElementById('submitEntryBtn').addEventListener('click', async (ev) => {
        ev.preventDefault();
        const entryNameEl = document.getElementById('entryName');
        const checkbox = document.getElementById('confirmCheckbox');
        const statusEl = document.getElementById('entryStatus');
        statusEl.textContent = '';
        const name = entryNameEl.value.trim();
        if(!checkbox.checked){ statusEl.textContent = 'Please confirm you completed the steps.'; return; }
        if(!name){ statusEl.textContent = 'Please enter your name.'; return; }

        // disable while submitting
        const btn = document.getElementById('submitEntryBtn');
        btn.disabled = true;
        btn.textContent = 'Submitting‚Ä¶';
        try {
          // ensure auth state (anonymous)
          if(!auth.currentUser){
            try{ await signInAnonymously(auth); } catch(e){ console.warn('anonymous sign-in failed', e); }
          }
          // save entry
          await addDoc(collection(db, ENTRIES_COLLECTION_PATH), {
            giveawayId: item.id,
            giveawayTitle: item.title || '',
            name: name,
            verifiedByAdmin: false,
            createdAt: serverTimestamp()
          });
          statusEl.textContent = 'Name submitted ‚Äî thank you! We will verify your screenshots.';
          // optionally clear input
          entryNameEl.value = '';
          checkbox.checked = false;
        } catch (err){
          console.error('Failed to submit entry', err);
          statusEl.textContent = 'Failed to submit ‚Äî try again.';
        } finally {
          btn.disabled = false;
          btn.textContent = 'Submit Name';
          setTimeout(()=>{ statusEl.textContent = ''; }, 6000);
        }
      });

      document.getElementById('modalCloseBtn').addEventListener('click', ()=> closeModal());
      backdrop.addEventListener('click', backdropClickHandler);

      if(pushState){ try{ history.pushState({ giveawayId:id }, '', `?id=${encodeURIComponent(id)}`); }catch(e){} }
    }

    function backdropClickHandler(e){ if(e.target===backdrop) closeModal(); }
    function closeModal(popState = true){ backdrop.style.display='none'; modalContainer.style.display='none'; modalContainer.innerHTML=''; backdrop.setAttribute('aria-hidden','true'); clearCountdown(); backdrop.removeEventListener('click', backdropClickHandler); if(popState){ try{ history.pushState({}, '', location.pathname); }catch(e){} } }

    // fetch and render giveaways
    try {
      const q = query(collection(db, GIVEAWAYS_COLLECTION_PATH), orderBy('createdAt','desc'));
      onSnapshot(q, snap => {
        const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        giveawaysCache = docs;
        renderGrid(docs);
        // open modal if ?id= present
        const urlId = new URLSearchParams(location.search).get('id');
        if(urlId){
          const found = giveawaysCache.find(x=>x.id===urlId);
          if(found) openGiveawayModal(urlId, false);
        }
      }, err => { console.error('giveaways onSnapshot error', err); giveGrid.innerHTML = '<div class="text-red-600">Could not load giveaways.</div>'; });
    } catch(err){ console.error('Giveaways init error', err); giveGrid.innerHTML = '<div class="text-red-600">Could not load giveaways.</div>'; }

    pills.forEach(p => p.addEventListener('click', ()=>{ pills.forEach(x=>x.classList.remove('active')); p.classList.add('active'); currentFilter = p.dataset.filter; renderGrid(giveawaysCache); }));

    // --------- ADDED: Winners loading logic (loads into the Winners tab area) ----------
    // Use the exact path we validated earlier so the public view reads the same collection admin writes to.
    const WINNERS_PATH = `artifacts/${ARTIFACT_ID}/public/data/winners`;

    // Ensure there's a container for winners (will inject into winnersSection if present)
    function ensureWinnersContainer() {
      // Prefer the winnersSection you have injected above; otherwise create an element within the giveaways area.
      let container = document.getElementById('winnersWrap');
      if (container) return container;

      const winnersSection = document.getElementById('winnersSection');
      if (winnersSection) {
        container = document.createElement('div');
        container.id = 'winnersWrap';
        container.className = 'grid-3';
        winnersSection.appendChild(container);
        return container;
      }

      // fallback to adding to main section
      const main = document.querySelector('main') || document.body;
      container = document.createElement('div');
      container.id = 'winnersWrap';
      container.className = 'grid-3';
      main.appendChild(container);
      return container;
    }

    function renderWinnersList(docs) {
      const wrap = ensureWinnersContainer();
      let empty = document.getElementById('winnersEmpty');
      if (!empty) {
        empty = document.createElement('div');
        empty.id = 'winnersEmpty';
        empty.className = 'empty hidden';
        empty.textContent = 'No winners yet.';
        wrap.parentNode && wrap.parentNode.appendChild(empty);
      }

      wrap.innerHTML = '';
      if (!docs || !docs.length) {
        empty.classList.remove('hidden');
        wrap.setAttribute('aria-busy','false');
        return;
      }
      empty.classList.add('hidden');
      wrap.setAttribute('aria-busy','false');

      docs.forEach(d => {
        const data = (d && d.data) ? d.data() : d;
        // transform Cloudinary images for uniform cropping
        const imgSrc = cloudinaryTransform(data && data.imageUrl ? data.imageUrl : 'images/opponent.png');
        const el = document.createElement('article');
        el.className = 'winner-card';
        el.innerHTML = `
          <img src="${escapeHtml(imgSrc)}" alt="${escapeHtml((data && data.name) || 'Winner')}" class="winner-thumb" onerror="this.onerror=null;this.src='images/opponent.png'"/>
          <div class="winner-body">
            <div class="winner-name">${escapeHtml((data && data.name) || '(no name)')}</div>
            <div class="winner-handle">${escapeHtml((data && data.handle) || '')}</div>
            <div class="winner-prize">Prize: ${escapeHtml((data && data.prize) || '')}</div>
          </div>
        `;
        wrap.appendChild(el);
      });
    }

    async function loadAndSubscribeWinners() {
      if (!db) { console.warn('loadAndSubscribeWinners: db not available'); return; }
      try {
        const q = query(collection(db, WINNERS_PATH), orderBy('createdAt','desc'));

        // one-time fetch to render immediately
        try {
          const snap = await getDocs(q);
          if (snap && snap.docs && snap.docs.length) {
            renderWinnersList(snap.docs);
          } else {
            renderWinnersList([]);
          }
        } catch(e) {
          console.warn('Winners one-time fetch failed (continuing to subscribe):', e);
        }

        // subscribe to live updates
        onSnapshot(q, s => {
          if (!s || !s.docs || !s.docs.length) {
            renderWinnersList([]);
            return;
          }
          renderWinnersList(s.docs);
        }, err => {
          console.error('winners onSnapshot error', err);
        });
      } catch (err) {
        console.error('loadAndSubscribeWinners failed', err);
      }
    }

    // Hook winners load to the Winners pill/tab button (click) and also trigger once on load
    function hookWinnersTabAndLoad() {
      // Look for a button that says "Winners" (case-insensitive) or use the winners pill
      const tabBtn = document.querySelector('[data-tab-btn="winners"]')
                   || Array.from(document.querySelectorAll('button, a')).find(el => (el.textContent || '').trim().toLowerCase() === 'winners')
                   || document.getElementById('pill-winners');

      if (tabBtn) {
        tabBtn.addEventListener('click', () => { setTimeout(loadAndSubscribeWinners, 120); });
      }

      // attempt to load immediately (safe)
      loadAndSubscribeWinners();
    }

    // run after DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', hookWinnersTabAndLoad);
    } else {
      hookWinnersTabAndLoad();
    }
    // --------- END winners logic ----------

    // nav dropdown (copied pattern)
    (function setupNavDropdown(){
      const navButton = document.getElementById('navButton');
      const dropdownMenu = document.getElementById('dropdownMenu');
      const navItems = document.querySelectorAll('.nav-item');
      const navTitle = document.getElementById('navTitle');
      const currentPage = window.location.pathname.split('/').pop();
      const pageTitles = { "index.html":"Home","bts.html":"Behind the Game","leila.html":"Meet Leila","questions.html":"Q&A","support-wall.html":"Support Wall","fixtures.html":"Fixtures & Live Scores","giveaways.html":"Giveaways" };
      navTitle.textContent = pageTitles[currentPage] || "Menu";
      navItems.forEach(link => { if(link.getAttribute('href')===currentPage) link.classList.add("font-semibold","text-rose-600"); });
      navButton.addEventListener('click', ()=>{ const isHidden = dropdownMenu.classList.contains('hidden'); if(isHidden){ dropdownMenu.classList.remove('hidden'); setTimeout(()=>dropdownMenu.classList.add('dropdown-open'),10);} else { dropdownMenu.classList.remove('dropdown-open'); setTimeout(()=>dropdownMenu.classList.add('hidden'),200);} });
      document.addEventListener('click', (e)=>{ if(!navButton.contains(e.target) && !dropdownMenu.contains(e.target)){ dropdownMenu.classList.remove('dropdown-open'); setTimeout(()=>dropdownMenu.classList.add('hidden'),200); }});
    })();

    // back/forward (open/close modal based on ?id=)
    window.addEventListener('popstate', (ev)=>{ const id = new URLSearchParams(location.search).get('id'); if(id) openGiveawayModal(id,false); else closeModal(false); });

  </script>
</body>
</html>
