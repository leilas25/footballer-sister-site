<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Giveaways ‚Äî The Footballer‚Äôs Sister</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pink-50 text-black font-sans">
  <header class="fixed top-0 w-full bg-pink-100 shadow z-50">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-6 py-4">
      <h1 class="text-xl font-bold text-rose-600">THE FOOTBALLER‚ÄôS SISTER</h1>
      <nav class="flex gap-4">
        <a href="index.html">Home</a>
        <a href="giveaways.html" class="font-semibold text-rose-700">Giveaways</a>
        <a href="winners.html">Winners</a>
      </nav>
    </div>
  </header>

  <main class="pt-28 pb-20">
    <section class="max-w-4xl mx-auto text-center mb-8 px-6">
      <h2 class="text-4xl font-bold text-rose-700">Win Exclusive Prizes üéÅ</h2>
      <p class="text-gray-600 mt-2">Enter current giveaways ‚Äî winners will be contacted via email / IG DM.</p>
    </section>

    <section class="max-w-4xl mx-auto px-6">
      <div class="flex gap-3 justify-center mb-6">
        <button data-filter="active" class="filter-btn px-4 py-2 rounded-full bg-rose-600 text-white">Active</button>
        <button data-filter="upcoming" class="filter-btn px-4 py-2 rounded-full bg-gray-100">Upcoming</button>
        <button data-filter="ended" class="filter-btn px-4 py-2 rounded-full bg-gray-100">Ended</button>
        <button data-filter="all" class="filter-btn px-4 py-2 rounded-full bg-gray-100">All</button>
      </div>

      <div id="giveawaysList" class="space-y-4">
        <p class="text-center text-gray-500">Loading giveaways‚Ä¶</p>
      </div>
    </section>
  </main>

  <footer class="bg-pink-900 text-white text-center py-6">
    <p>&copy; <span id="year"></span> The Footballer‚Äôs Sister</p>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBiIvIHLYEQc0UGDcg4Qq0-w2Sv8NHmc6w",
      authDomain: "football-site-c3aa9.firebaseapp.com",
      projectId: "football-site-c3aa9",
      storageBucket: "football-site-c3aa9.appspot.com",
      messagingSenderId: "65396604482",
      appId: "1:65396604482:web:0f31625a714aa8352337db"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const APP_PATH = 'artifacts/1:65396604482:web:0f31625a714aa8352337db/public/data';
    const GIVEAWAYS_PATH = `${APP_PATH}/giveaways`;

    const listEl = document.getElementById('giveawaysList');
    const filterBtns = document.querySelectorAll('.filter-btn');
    let filter = 'active';
    let items = [];

    function esc(s){ return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m])); }

    function computeStatus(g) {
      const now = Date.now();
      const endTs = g.ends?.toDate ? g.ends.toDate().getTime() : (g.endsRaw ? new Date(g.endsRaw).getTime() : null);
      if (!endTs) return 'upcoming';
      if (now > endTs) return 'ended';
      return 'active';
    }

    function render() {
      const displayed = items.filter(g => (filter==='all' || computeStatus(g) === filter));
      if (!displayed.length) { listEl.innerHTML = '<p class="text-center text-gray-500">No giveaways in this view.</p>'; return; }
      listEl.innerHTML = '';
      displayed.forEach(g => {
        const status = computeStatus(g);
        const img = g.imageUrl || 'images/giveaway-placeholder.png';
        const ends = g.ends?.toDate ? g.ends.toDate().toLocaleString() : (g.endsRaw || 'TBA');
        listEl.innerHTML += `
          <div class="bg-white p-4 rounded-xl shadow flex gap-4 items-center">
            <img src="${esc(img)}" class="w-28 h-20 object-cover rounded"/>
            <div class="flex-1">
              <div class="font-semibold text-lg">${esc(g.title||'Giveaway')}</div>
              <div class="text-sm text-gray-600">${esc(g.prize||'Prize')}</div>
              <div class="text-xs text-gray-500 mt-1">Ends: ${esc(ends)}</div>
            </div>
            <div class="text-right">
              <div class="mb-2 text-sm ${status==='active' ? 'text-green-700' : status==='upcoming' ? 'text-blue-700' : 'text-gray-600'} font-semibold">${status.toUpperCase()}</div>
              <a href="giveaway-detail.html?id=${encodeURIComponent(g.id)}" class="inline-block bg-rose-600 text-white px-4 py-2 rounded">Enter</a>
            </div>
          </div>
        `;
      });
    }

    const q = query(collection(db, GIVEAWAYS_PATH), orderBy('createdAt','desc'));
    onSnapshot(q, snap => {
      items = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      render();
    });

    filterBtns.forEach(b => b.addEventListener('click', () => {
      filterBtns.forEach(bb => bb.classList.remove('bg-rose-600','text-white'));
      filterBtns.forEach(bb => bb.classList.add('bg-gray-100'));
      b.classList.add('bg-rose-600','text-white');
      filter = b.dataset.filter;
      render();
    }));
    // default active
    document.querySelector('[data-filter="active"]').classList.add('bg-rose-600','text-white');
  </script>
</body>
</html>
